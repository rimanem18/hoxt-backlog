# TaskEditModalã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ - TDDè¦ä»¶å®šç¾©æ›¸

## ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±

- **ä½œæˆæ—¥**: 2025-12-15
- **æ›´æ–°æ—¥**: 2025-12-15
- **ã‚¿ã‚¹ã‚¯ç•ªå·**: TASK-1334
- **è¦ä»¶å**: todo-app
- **æ©Ÿèƒ½å**: TaskEditModalã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `app/client/src/features/todo/components/TaskEditModal.tsx`

---

## 1. æ©Ÿèƒ½ã®æ¦‚è¦

ğŸ”µ *TASK-1334ã€todo-app-requirements.md REQ-002ã€NFR-204*

TaskEditModalã¯ã€æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®è©³ç´°æƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ï¼‰ã‚’ç·¨é›†ã™ã‚‹ãŸã‚ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

### ä½•ã‚’ã™ã‚‹æ©Ÿèƒ½ã‹

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸã‚¿ã‚¹ã‚¯ã®æƒ…å ±ã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§è¡¨ç¤ºãƒ»ç·¨é›†ã§ãã‚‹
- ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ï¼ˆMarkdownå¯¾å¿œï¼‰ã€å„ªå…ˆåº¦ã‚’å¤‰æ›´ã§ãã‚‹
- ä¿å­˜ãƒœã‚¿ãƒ³ã§ã‚¿ã‚¹ã‚¯æ›´æ–°ã‚’å®Ÿè¡Œã—ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹

### ã©ã®ã‚ˆã†ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ã‹

- **å•é¡Œ**: ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢ã§ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã™ã‚‹ã¨ç”»é¢ãŒç‹­ãã€è¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åŒæ™‚ç·¨é›†ãŒå›°é›£
- **è§£æ±º**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§å°‚ç”¨ã®ç·¨é›†ç”»é¢ã‚’æä¾›ã—ã€ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã‚’ã¾ã¨ã‚ã¦å¤‰æ›´å¯èƒ½ã«ã™ã‚‹

### æƒ³å®šã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼

- **As a** ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **So that** æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®è©³ç´°æƒ…å ±ã‚’åŠ¹ç‡çš„ã«ä¿®æ­£ã§ãã‚‹

### ã‚·ã‚¹ãƒ†ãƒ å†…ã§ã®ä½ç½®ã¥ã‘

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 15 (SSG) + React 19 + TypeScript 5
- **çŠ¶æ…‹ç®¡ç†**: TanStack React Queryï¼ˆã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ï¼‰ã€ãƒ­ãƒ¼ã‚«ãƒ«stateï¼ˆãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å€¤ï¼‰
- **è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: TaskListï¼ˆã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼‰
- **ä¾å­˜Context**: `TaskServicesProvider`ï¼ˆContext-based DIï¼‰
- **ãƒ•ãƒƒã‚¯å–å¾—æ–¹æ³•**: `useTaskServices()` ã‹ã‚‰ `useTaskMutations` ã‚’å–å¾—

### å‚ç…§ã—ãŸEARSè¦ä»¶

- **REQ-002**: ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã‚’æ›´æ–°ã§ããªã‘ã‚Œã°ãªã‚‰ãªã„
- **REQ-104**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œæœªç€æ‰‹ã€ã«è¨­å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ˆç·¨é›†æ™‚ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¿æŒï¼‰
- **NFR-204**: ã‚¿ã‚¹ã‚¯ã®è©³ç´°ç·¨é›†ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§å®Ÿæ–½ã§ããªã‘ã‚Œã°ãªã‚‰ãªã„

### å‚ç…§ã—ãŸè¨­è¨ˆæ–‡æ›¸

- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: [architecture.md](../../../design/todo-app/architecture.md) - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€Context-based DI
- **APIä»•æ§˜**: [api-endpoints.md](../../../design/todo-app/api-endpoints.md) - PUT /tasks/{id}
- **ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«**: [todo-app-phase7.md](../../../tasks/todo-app-phase7.md) Line:261-372

---

## 2. å…¥åŠ›ãƒ»å‡ºåŠ›ã®ä»•æ§˜

ğŸ”µ *app/packages/shared-schemas/src/tasks.tsã€useTaskMutations.ts*

### å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆPropsï¼‰

```typescript
interface TaskEditModalProps {
  /** ç·¨é›†å¯¾è±¡ã®ã‚¿ã‚¹ã‚¯æƒ…å ±ï¼ˆnullã®å ´åˆã¯ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤ºï¼‰ */
  task: Task | null;
  /** ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹éš›ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
  onClose: () => void;
}
```

#### Taskå‹å®šç¾©ï¼ˆshared-schemasï¼‰

ğŸ”µ *app/packages/shared-schemas/src/tasks.ts*

```typescript
type Task = {
  id: string;                  // UUID
  userId: string;              // UUID
  title: string;               // 1-100æ–‡å­—
  description: string | null;  // Markdownè¨˜æ³•å¯¾å¿œã€åˆ¶é™ãªã—
  priority: 'high' | 'medium' | 'low';
  status: 'not_started' | 'in_progress' | 'in_review' | 'completed';
  createdAt: string;           // ISO8601å½¢å¼
  updatedAt: string;           // ISO8601å½¢å¼
};
```

### å†…éƒ¨çŠ¶æ…‹ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«stateï¼‰

ğŸŸ¡ *TaskCreateForm.tsxã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒ*

```typescript
const [title, setTitle] = useState<string>(task?.title || '');
const [description, setDescription] = useState<string>(task?.description || '');
const [priority, setPriority] = useState<'high' | 'medium' | 'low'>(task?.priority || 'medium');
```

### Context-based DIã«ã‚ˆã‚‹ãƒ•ãƒƒã‚¯å–å¾—

ğŸ”µ *TaskCreateForm.tsx L19-21ã€TaskServicesContext.tsx*

```typescript
const services = useTaskServices();
const { updateTask } = services.useTaskMutations();
```

### å‡ºåŠ›å€¤ï¼ˆAPIå‘¼ã³å‡ºã—ï¼‰

ğŸ”µ *useTaskMutations.ts L124-150*

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `PUT /tasks/{id}`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼ˆUpdateTaskBodyï¼‰**:

ğŸ”µ *ä»•æ§˜æ˜ç¢ºåŒ–: å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¸¸ã«é€ä¿¡*

```typescript
{
  title: string;               // 1-100æ–‡å­—ï¼ˆç¾åœ¨ã®å€¤ã‚’å¸¸ã«é€ä¿¡ï¼‰
  description: string | null;  // Markdownè¨˜æ³•å¯¾å¿œï¼ˆç¾åœ¨ã®å€¤ã‚’å¸¸ã«é€ä¿¡ï¼‰
  priority: 'high' | 'medium' | 'low'; // ç¾åœ¨ã®å€¤ã‚’å¸¸ã«é€ä¿¡
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆUpdateTaskResponseï¼‰**:

```typescript
{
  data: Task; // æ›´æ–°å¾Œã®ã‚¿ã‚¹ã‚¯æƒ…å ±
}
```

### å…¥å‡ºåŠ›ã®é–¢ä¿‚æ€§

1. **åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼**:
   - `task` propsã‚’å—ã‘å–ã‚‹ â†’ ãƒ­ãƒ¼ã‚«ãƒ«stateã‚’åˆæœŸåŒ–ï¼ˆ`title`, `description`, `priority`ï¼‰
   - `task === null` ã®å ´åˆã¯ `null` ã‚’è¿”ã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤º

2. **é€ä¿¡ãƒ•ãƒ­ãƒ¼**:
   - ãƒ•ã‚©ãƒ¼ãƒ submit â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â†’ `updateTask.mutate()` å‘¼ã³å‡ºã—
   - å¼•æ•°: `{ id: task.id, input: { title, description, priority } }` ï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é€ä¿¡ï¼‰
   - æˆåŠŸæ™‚ â†’ `onClose()` å®Ÿè¡Œ â†’ è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
   - å¤±æ•—æ™‚ â†’ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆåˆæœŸå®Ÿè£…ã§å¯¾å¿œï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

ğŸ”µ *architecture.md - ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ãƒ­ãƒ¼ï¼ˆæ›´æ–°ãƒ•ãƒ­ãƒ¼ã‚‚åŒæ§˜ï¼‰*

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant M as TaskEditModal
    participant S as useTaskServices
    participant H as useTaskMutations
    participant A as API (Hono)
    participant DB as PostgreSQL (RLS)

    U->>M: ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    M->>S: useTaskServices() å‘¼ã³å‡ºã—
    S-->>M: { useTaskMutations }
    M->>H: useTaskMutations() å‘¼ã³å‡ºã—
    H-->>M: { updateTask }
    M->>M: task propsã‚’å—ã‘å–ã‚Š<br/>stateã‚’åˆæœŸåŒ–
    U->>M: ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã‚’å¤‰æ›´
    U->>M: ä¿å­˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    M->>M: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    M->>H: updateTask.mutate({ id, input })
    H->>A: PUT /tasks/{id}<br/>(JWT + UpdateTaskBody)
    A->>A: JWTæ¤œè¨¼ + Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    A->>DB: UPDATE tasks SET ...
    DB-->>A: æ›´æ–°å®Œäº†
    A-->>H: 200 OK + TaskDTO
    H->>H: queryClient.invalidateQueries('tasks')
    H-->>M: onSuccess ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    M->>M: onClose() å®Ÿè¡Œ
    M-->>U: ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
```

### å‚ç…§ã—ãŸEARSè¦ä»¶

- **REQ-002**: ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã‚’æ›´æ–°ã§ããªã‘ã‚Œã°ãªã‚‰ãªã„
- **EDGE-001**: ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºæ–‡å­—ã®å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹
- **EDGE-002**: ã‚¿ã‚¤ãƒˆãƒ«ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¿ã‚¤ãƒˆãƒ«ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹

### å‚ç…§ã—ãŸè¨­è¨ˆæ–‡æ›¸

- **å‹å®šç¾©**: [app/packages/shared-schemas/src/tasks.ts](../../../../app/packages/shared-schemas/src/tasks.ts) - Taskå‹ã€UpdateTaskBodyå‹
- **ãƒ•ãƒƒã‚¯**: [app/client/src/features/todo/hooks/useTaskMutations.ts](../../../../app/client/src/features/todo/hooks/useTaskMutations.ts) - updateTaskå®Ÿè£…
- **Context**: [app/client/src/features/todo/lib/TaskServicesContext.tsx](../../../../app/client/src/features/todo/lib/TaskServicesContext.tsx) - useTaskServiceså®Ÿè£…

---

## 3. åˆ¶ç´„æ¡ä»¶

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

ğŸ”´ *NFR-002ï¼ˆã‚¿ã‚¹ã‚¯ä½œæˆï¼‰ã‚’æ›´æ–°ã«ã‚‚é¡æ¨é©ç”¨ï¼ˆã‚¿ã‚¹ã‚¯æ›´æ–°å°‚ç”¨ã®NFRã¯å­˜åœ¨ã—ãªã„ï¼‰*

- **æƒ³å®š**: ã‚¿ã‚¹ã‚¯æ›´æ–°APIã¯500msä»¥å†…ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨ãŒæœ›ã¾ã—ã„ï¼ˆNFR-002æº–æ‹ ï¼‰
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´æœ€é©åŒ–**: TanStack Queryã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã«ã‚ˆã‚Šã€UIãŒå³åº§ã«æœ€æ–°çŠ¶æ…‹ã‚’åæ˜ ã™ã‚‹

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

ğŸ”µ *NFR-102ã€NFR-103ã€NFR-104*

- **NFR-102**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†è‡ªèº«ã®ã‚¿ã‚¹ã‚¯ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ˆRLSï¼‰
- **NFR-103**: ã‚¿ã‚¹ã‚¯æ“ä½œAPIã¯ã™ã¹ã¦JWTèªè¨¼ã‚’å¿…é ˆã¨ã™ã‚‹
- **NFR-104**: ã‚¿ã‚¹ã‚¯ã®å…¥åŠ›å€¤ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚µãƒ¼ãƒãƒ¼å´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«åŠ ãˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚ç©ºæ–‡å­—ãƒ»æ–‡å­—æ•°åˆ¶é™ã‚’ãƒã‚§ãƒƒã‚¯

### äº’æ›æ€§è¦ä»¶

ğŸ”µ *CLAUDE.mdã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³*

- **React 19.1.0**: æœ€æ–°ã®Reactæ©Ÿèƒ½ã‚’æ´»ç”¨
- **TypeScript 5**: å‹å®‰å…¨æ€§ã‚’å³å®ˆ
- **Tailwind CSS 4**: ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ `#710000`ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ `#ff6a00` ã‚’é©ç”¨
- **Bunæ¨™æº–ãƒ†ã‚¹ãƒˆ**: `bun:test`ã‚’ä½¿ç”¨ã—ãŸãƒ¦ãƒ‹ãƒƒãƒˆ/çµ±åˆãƒ†ã‚¹ãƒˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ¶ç´„

ğŸ”µ *architecture.mdã€CLAUDE.mdã€frontend.md*

- **Context-based DI**: `TaskServicesProvider`ã‚’ä½¿ç”¨ã—ã¦`useTaskMutations`ã‚’æ³¨å…¥
- **ãƒ•ãƒƒã‚¯å–å¾—**: `useTaskServices()` ã‹ã‚‰ `useTaskMutations` ã‚’å–å¾—ï¼ˆç›´æ¥importã—ãªã„ï¼‰
- **Propsã®æ˜ç¤ºçš„ä½¿ç”¨**: `props.task`, `props.onClose`ã®ã‚ˆã†ã«è¨˜è¿°ï¼ˆ`CLAUDE.md`å¿…é ˆé …ç›®ï¼‰
- **React.memo**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚`React.memo`ã§ãƒ©ãƒƒãƒ—
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®šç¾©å½¢å¼**:
  ```typescript
  function TaskEditModal(props: TaskEditModalProps): React.ReactNode {
    const services = useTaskServices();
    const { updateTask } = services.useTaskMutations();
    // ...
  }
  export default React.memo(TaskEditModal);
  ```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„

ğŸ”µ *todo-app-requirements.md L136-187*

- **title**: VARCHAR(100)ã€NOT NULLã€CHECKåˆ¶ç´„ï¼ˆç©ºæ–‡å­—ä¸å¯ï¼‰
- **description**: TEXTã€NULLè¨±å¯
- **priority**: VARCHAR(10)ã€CHECKåˆ¶ç´„ï¼ˆ'high', 'medium', 'low'ã®ã¿ï¼‰
- **RLS Policy**: `user_id = current_setting('app.current_user_id')::uuid`

### APIåˆ¶ç´„

ğŸ”µ *useTaskMutations.tsã€updateTaskBodySchema*

- **HTTPãƒ¡ã‚½ãƒƒãƒ‰**: PUT `/tasks/{id}`
- **ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼**: `Authorization: Bearer {JWT}`
- **ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**: `UpdateTaskBody`ï¼ˆtitle, description, priorityã¯å…¨ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã ãŒã€å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é€ä¿¡ï¼‰
- **æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK + `{ data: Task }`
- **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
  - 400 Bad Request: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
  - 401 Unauthorized: JWTä¸æ­£
  - 404 Not Found: ã‚¿ã‚¹ã‚¯ä¸å­˜åœ¨ or RLSã§æ‹’å¦

### å‚ç…§ã—ãŸEARSè¦ä»¶

- **REQ-402**: ã‚·ã‚¹ãƒ†ãƒ ã¯Supabase Authã®JWTèªè¨¼ã‚’ä½¿ç”¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
- **REQ-403**: ã‚·ã‚¹ãƒ†ãƒ ã¯Row-Level Security(RLS)ã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ã‚¿ã‚¹ã‚¯åˆ†é›¢ã‚’å®Ÿç¾ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
- **REQ-409**: ã‚·ã‚¹ãƒ†ãƒ ã¯Bunæ¨™æº–ãƒ†ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ãŸTDDé–‹ç™ºã‚’å®Ÿæ–½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
- **NFR-102**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†è‡ªèº«ã®ã‚¿ã‚¹ã‚¯ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„(RLS)
- **NFR-104**: ã‚¿ã‚¹ã‚¯ã®å…¥åŠ›å€¤ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
- **NFR-201**: UIã¯ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼(ãƒ™ãƒ¼ã‚¹#710000ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ#ff6a00)ã‚’é©ç”¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„

### å‚ç…§ã—ãŸè¨­è¨ˆæ–‡æ›¸

- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: [architecture.md](../../../design/todo-app/architecture.md) - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ãƒ­ãƒ¼ï¼ˆRLSï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: [todo-app-requirements.md](../../../spec/todo-app-requirements.md) L136-187 - tasksãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

---

## 4. æƒ³å®šã•ã‚Œã‚‹ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

#### æ­£å¸¸ç³»: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹

ğŸ”µ *TASK-1334 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹*

**Given**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢ã§ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**When**: `TaskEditModal`ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã€`task` propsã«ç·¨é›†å¯¾è±¡ã®ã‚¿ã‚¹ã‚¯æƒ…å ±ãŒæ¸¡ã•ã‚Œã‚‹

**Then**:
- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒç”»é¢ä¸­å¤®ã«è¡¨ç¤ºã•ã‚Œã‚‹
- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›æ¬„ã«æ—¢å­˜ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- èª¬æ˜å…¥åŠ›æ¬„ã«æ—¢å­˜ã®èª¬æ˜ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆnullã®å ´åˆã¯ç©ºæ–‡å­—ï¼‰
- å„ªå…ˆåº¦é¸æŠæ¬„ã«æ—¢å­˜ã®å„ªå…ˆåº¦ãŒé¸æŠã•ã‚Œã‚‹
- ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã¨ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### æ­£å¸¸ç³»: ã‚¿ã‚¹ã‚¯ãŒæ›´æ–°ã•ã‚Œã‚‹

ğŸ”µ *TASK-1334 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã‚’ã€Œæ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«ã€ã«å¤‰æ›´ã—ã€ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**:
- `updateTask.mutate()` ãŒå‘¼ã°ã‚Œã‚‹
- å¼•æ•°: `{ id: task.id, input: { title: 'æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«', description: (ç¾åœ¨ã®å€¤), priority: (ç¾åœ¨ã®å€¤) } }`
- APIæˆåŠŸæ™‚ã« `onClose()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ã‚‹
- ã‚¿ã‚¹ã‚¯ä¸€è¦§ãŒè‡ªå‹•çš„ã«å†å–å¾—ã•ã‚Œã‚‹ï¼ˆTanStack Queryã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼‰

#### æ­£å¸¸ç³»: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ï¼‰

ğŸ”µ *TASK-1334 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€TaskCreateForm.test.tsxã®ãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**:
- `props.onClose()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ã‚‹
- ã‚¿ã‚¹ã‚¯æƒ…å ±ã¯å¤‰æ›´ã•ã‚Œãªã„

#### æ­£å¸¸ç³»: task === null ã§ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤º

ğŸŸ¡ *TASK-1334å®Ÿè£…è©³ç´°ï¼ˆL289ï¼‰*

**Given**: `TaskEditModal`ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹

**When**: `task` propsãŒ `null`

**Then**:
- `return null;` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯è¡¨ç¤ºã•ã‚Œãªã„

#### æ­£å¸¸ç³»: é€ä¿¡ä¸­ã¯ä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹

ğŸ”µ *TaskCreateForm.tsx L105ã€frontend.md - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`updateTask.isPending === true`

**Then**:
- ä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ï¼ˆ`disabled={updateTask.isPending}`ï¼‰
- äºŒé‡é€ä¿¡ãŒé˜²æ­¢ã•ã‚Œã‚‹

### ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

#### ç•°å¸¸ç³»: ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºæ–‡å­—ã®å ´åˆã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

ğŸ”µ *EDGE-001ã€TaskCreateForm.test.tsxã®ãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã‚’ç©ºæ–‡å­—ã«ã—ã¦ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**:
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§æ‹’å¦ã•ã‚Œã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- `updateTask.mutate()` ã¯å‘¼ã°ã‚Œãªã„

#### ç•°å¸¸ç³»: ã‚¿ã‚¤ãƒˆãƒ«ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã«å…¥åŠ›åˆ¶é™

ğŸ”µ *EDGE-002ã€TaskCreateForm.test.tsxã®ãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã«101æ–‡å­—ç›®ã‚’å…¥åŠ›ã—ã‚ˆã†ã¨ã™ã‚‹

**Then**:
- `maxLength={100}` å±æ€§ã«ã‚ˆã‚Š101æ–‡å­—ç›®ä»¥é™ã¯å…¥åŠ›ä¸å¯
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼ˆå…¥åŠ›è‡ªä½“ãŒåˆ¶é™ã•ã‚Œã‚‹ï¼‰

#### ç•°å¸¸ç³»: APIæ›´æ–°å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

ğŸ”µ *useTaskMutations.ts L131-134ã€TaskCreateForm.test.tsxã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€APIå‘¼ã³å‡ºã—ãŒå¤±æ•—

**Then**:
- `updateTask.mutate()`ã®onErrorã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œã‚¿ã‚¹ã‚¯æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯é–‰ã˜ãªã„

### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹

#### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: èª¬æ˜ãŒnullã®å ´åˆ

ğŸŸ¡ *Taskå‹å®šç¾©ã€TaskItem.tsxã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: ã‚¿ã‚¹ã‚¯ã®`description`ãŒ`null`

**When**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**Then**:
- èª¬æ˜å…¥åŠ›æ¬„ã¯ç©ºæ–‡å­—ã§åˆæœŸåŒ–ã•ã‚Œã‚‹ï¼ˆ`task?.description || ''`ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èª¬æ˜ã‚’æ–°è¦å…¥åŠ›ã§ãã‚‹

#### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: å„ªå…ˆåº¦ãŒå¤‰æ›´ã•ã‚Œãªã„å ´åˆ

ğŸ”µ *UpdateTaskBodyã®ä»•æ§˜ï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é€ä¿¡ï¼‰*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã®ã¿å¤‰æ›´ã—ã€å„ªå…ˆåº¦ã¯å¤‰æ›´ã—ãªã„

**Then**:
- `updateTask.mutate()` ã® `input` ã«ã¯å¤‰æ›´ã•ã‚ŒãŸã‚¿ã‚¤ãƒˆãƒ«ã¨ã€å¤‰æ›´ã•ã‚Œã¦ã„ãªã„èª¬æ˜ãƒ»å„ªå…ˆåº¦ãŒå«ã¾ã‚Œã‚‹
- APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆtitle, description, priorityï¼‰ãŒé€ä¿¡ã•ã‚Œã‚‹

#### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºä¸­ã«task propsãŒå¤‰æ›´ã•ã‚Œã‚‹

ğŸ”´ *æƒ³å®šã•ã‚Œã‚‹å‹•ä½œï¼ˆæ—¢å­˜è³‡æ–™ã«ãªã„æ¨æ¸¬ï¼‰*

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`task` propsã‚’æ›´æ–°

**Then**:
- ãƒ­ãƒ¼ã‚«ãƒ«stateã¯æ›´æ–°ã•ã‚Œãªã„ï¼ˆuseStateåˆæœŸåŒ–ã¯åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ã¿ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ä¸­ã®å†…å®¹ãŒä¿æŒã•ã‚Œã‚‹
- **æ¨å¥¨**: è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºä¸­ã«`task`ã‚’å¤‰æ›´ã—ãªã„è¨­è¨ˆã¨ã™ã‚‹

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

ğŸ”µ *architecture.md - ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ãƒ­ãƒ¼ï¼ˆæ›´æ–°ã‚‚åŒæ§˜ï¼‰*

```mermaid
flowchart TD
    A["ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯"] --> B["TaskList: setEditingTask(task)"]
    B --> C["TaskEditModal: task propsã‚’å—ã‘å–ã‚‹"]
    C --> D["useTaskServices() ã§ãƒ•ãƒƒã‚¯å–å¾—"]
    D --> E["useState ã§ãƒ­ãƒ¼ã‚«ãƒ«stateåˆæœŸåŒ–"]
    E --> F["ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º"]
    F --> G["ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›å¤‰æ›´"]
    G --> H["ä¿å­˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯"]
    H --> I["ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"]
    I -->|"æˆåŠŸ"| J["updateTask.mutate()"]
    I -->|"å¤±æ•—"| K["ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º"]
    J --> L["updateTask.isPending = true<br/>ï¼ˆä¿å­˜ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ï¼‰"]
    L --> M["APIå‘¼ã³å‡ºã—<br/>(PUT /tasks/:id)"]
    M -->|"æˆåŠŸ"| N["onSuccess: onClose() å®Ÿè¡Œ"]
    M -->|"å¤±æ•—"| O["onError: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º"]
    N --> P["TaskList: setEditingTask(null)"]
    P --> Q["ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹"]
```

### å‚ç…§ã—ãŸEARSè¦ä»¶

- **REQ-002**: ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã‚’æ›´æ–°ã§ããªã‘ã‚Œã°ãªã‚‰ãªã„
- **EDGE-001**: ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºæ–‡å­—ã®å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹
- **EDGE-002**: ã‚¿ã‚¤ãƒˆãƒ«ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¿ã‚¤ãƒˆãƒ«ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹
- **EDGE-003**: å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ãƒ»å‰Šé™¤ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ï¼ˆAPIå´ã§å‡¦ç†ï¼‰
- **EDGE-005**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œé€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€ã¨è¡¨ç¤ºã™ã‚‹

### å‚ç…§ã—ãŸè¨­è¨ˆæ–‡æ›¸

- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: [architecture.md](../../../design/todo-app/architecture.md) - ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ãƒ­ãƒ¼
- **å‚è€ƒå®Ÿè£…**: [app/client/src/features/todo/components/TaskCreateForm.tsx](../../../../app/client/src/features/todo/components/TaskCreateForm.tsx)

---

## 5. EARSè¦ä»¶ãƒ»è¨­è¨ˆæ–‡æ›¸ã¨ã®å¯¾å¿œé–¢ä¿‚

### å‚ç…§ã—ãŸãƒ¦ãƒ¼ã‚¶ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

- **ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å**: ã‚¿ã‚¹ã‚¯ç·¨é›†æ©Ÿèƒ½ï¼ˆè©³ç´°ã¯todo-app-user-stories.mdå‚ç…§ï¼‰

### å‚ç…§ã—ãŸæ©Ÿèƒ½è¦ä»¶

- **REQ-002**: ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã‚’æ›´æ–°ã§ããªã‘ã‚Œã°ãªã‚‰ãªã„ ğŸ”µ
- **REQ-104**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œæœªç€æ‰‹ã€ã«è¨­å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ˆç·¨é›†æ™‚ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¿æŒï¼‰ ğŸ”µ

### å‚ç…§ã—ãŸéæ©Ÿèƒ½è¦ä»¶

- **NFR-002**: ã‚¿ã‚¹ã‚¯ä½œæˆAPIã¯500msä»¥å†…ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã•ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ˆæ›´æ–°ã«ã‚‚é¡æ¨é©ç”¨ï¼‰ ğŸ”´
- **NFR-102**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†è‡ªèº«ã®ã‚¿ã‚¹ã‚¯ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„(RLS) ğŸ”µ
- **NFR-103**: ã‚¿ã‚¹ã‚¯æ“ä½œAPIã¯ã™ã¹ã¦JWTèªè¨¼ã‚’å¿…é ˆã¨ã™ã‚‹ ğŸ”µ
- **NFR-104**: ã‚¿ã‚¹ã‚¯ã®å…¥åŠ›å€¤ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ ğŸ”µ
- **NFR-201**: UIã¯ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼(ãƒ™ãƒ¼ã‚¹#710000ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ#ff6a00)ã‚’é©ç”¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ ğŸ”µ
- **NFR-204**: ã‚¿ã‚¹ã‚¯ã®è©³ç´°ç·¨é›†ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§å®Ÿæ–½ã§ããªã‘ã‚Œã°ãªã‚‰ãªã„ ğŸ”µ

### å‚ç…§ã—ãŸEdgeã‚±ãƒ¼ã‚¹

- **EDGE-001**: ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºæ–‡å­—ã®å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ ğŸŸ¡
- **EDGE-002**: ã‚¿ã‚¤ãƒˆãƒ«ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¿ã‚¤ãƒˆãƒ«ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ ğŸ”´
- **EDGE-003**: å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ãƒ»å‰Šé™¤ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ ğŸŸ¡
- **EDGE-005**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œé€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€ã¨è¡¨ç¤ºã™ã‚‹ ğŸŸ¡

### å‚ç…§ã—ãŸå—ã‘å…¥ã‚ŒåŸºæº–

- ã‚¿ã‚¹ã‚¯ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- ã‚¿ã‚¹ã‚¯æƒ…å ±ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã‚‹ã“ã¨
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ“ä½œãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
- é€ä¿¡ä¸­ã¯ä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã“ã¨

### å‚ç…§ã—ãŸè¨­è¨ˆæ–‡æ›¸

- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: [architecture.md](../../../design/todo-app/architecture.md)
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹æˆ
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ãƒ­ãƒ¼ï¼ˆRLSï¼‰
  - ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ãƒ­ãƒ¼ï¼ˆæ›´æ–°ã‚‚åŒæ§˜ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: ä¸Šè¨˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å†…ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³å‚ç…§
- **å‹å®šç¾©**: [app/packages/shared-schemas/src/tasks.ts](../../../../app/packages/shared-schemas/src/tasks.ts)
  - Taskå‹
  - UpdateTaskBodyå‹
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: [todo-app-requirements.md](../../../spec/todo-app-requirements.md) L136-187
  - tasksãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
- **APIä»•æ§˜**: [useTaskMutations.ts](../../../../app/client/src/features/todo/hooks/useTaskMutations.ts)
  - updateTaskå®Ÿè£…

---

## 6. ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

ğŸ”µ *CLAUDE.md - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ãƒ«ãƒ¼ãƒ«*

- **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `app/client/src/features/todo/__tests__/TaskEditModal.test.tsx`
- **é…ç½®ç†ç”±**: featureé…ä¸‹ã®`__tests__`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é›†ç´„

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è©³ç´°ï¼ˆGiven-When-Thenå½¢å¼ï¼‰

#### æ­£å¸¸ç³»

##### 1. ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**Given**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢ã§ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`TaskEditModal`ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã€`task` propsã«ç·¨é›†å¯¾è±¡ã®ã‚¿ã‚¹ã‚¯æƒ…å ±ãŒæ¸¡ã•ã‚Œã‚‹

**When**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹

**Then**:
- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒç”»é¢ä¸­å¤®ã«è¡¨ç¤ºã•ã‚Œã‚‹
- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›æ¬„ã«æ—¢å­˜ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆ`screen.getByLabelText('ã‚¿ã‚¤ãƒˆãƒ«')` ã®å€¤ãŒ `task.title`ï¼‰
- èª¬æ˜å…¥åŠ›æ¬„ã«æ—¢å­˜ã®èª¬æ˜ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆnullã®å ´åˆã¯ç©ºæ–‡å­—ï¼‰
- å„ªå…ˆåº¦é¸æŠæ¬„ã«æ—¢å­˜ã®å„ªå…ˆåº¦ãŒé¸æŠã•ã‚Œã‚‹
- ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã¨ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

##### 2. ã‚¿ã‚¹ã‚¯ãŒæ›´æ–°ã•ã‚Œã‚‹

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã‚’ã€Œæ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«ã€ã«å¤‰æ›´ã—ã€ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**:
- `updateTask.mutate()` ãŒå‘¼ã°ã‚Œã‚‹
- å¼•æ•°: `{ id: task.id, input: { title: 'æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«', description: ..., priority: ... } }`
- APIæˆåŠŸæ™‚ã« `onClose()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹

##### 3. ãƒ•ã‚©ãƒ¼ãƒ ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ï¼ˆä»Šå›ã¯ä¸è¦ï¼‰

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚

**When**: è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`task`ã‚’nullã«è¨­å®š

**Then**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒéè¡¨ç¤ºã«ãªã‚Šã€è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢

##### 4. task === null ã§ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤º

**Given**: `TaskEditModal`ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹

**When**: `task` propsãŒ `null`

**Then**:
- `return null;` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼ˆ`screen.queryByRole('dialog')` ãŒ `null`ï¼‰

##### 5. é€ä¿¡ä¸­ã¯ä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã€`updateTask.isPending === true`

**When**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹

**Then**:
- ä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ï¼ˆ`screen.getByRole('button', { name: 'ä¿å­˜' }).disabled === true`ï¼‰

#### ç•°å¸¸ç³»

##### 1. ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºæ–‡å­—ã®å ´åˆã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã‚’ç©ºæ–‡å­—ã«ã—ã¦ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**:
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§æ‹’å¦ã•ã‚Œã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆ`screen.getByText('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')`ï¼‰
- `updateTask.mutate()` ã¯å‘¼ã°ã‚Œãªã„

##### 2. ã‚¿ã‚¤ãƒˆãƒ«ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã«å…¥åŠ›åˆ¶é™

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã«101æ–‡å­—ã‚’å…¥åŠ›ã—ã‚ˆã†ã¨ã™ã‚‹

**Then**:
- `maxLength={100}` å±æ€§ã«ã‚ˆã‚Š101æ–‡å­—ç›®ä»¥é™ã¯å…¥åŠ›ä¸å¯
- å…¥åŠ›æ¬„ã®å€¤ã¯100æ–‡å­—ã¾ã§ï¼ˆ`screen.getByLabelText('ã‚¿ã‚¤ãƒˆãƒ«').value.length === 100`ï¼‰

##### 3. APIæ›´æ–°å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€APIå‘¼ã³å‡ºã—ãŒå¤±æ•—ï¼ˆ`updateTask.mutate()`ã®onErrorãŒå®Ÿè¡Œï¼‰

**Then**:
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œã‚¿ã‚¹ã‚¯æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆ`screen.getByText('ã‚¿ã‚¹ã‚¯æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ')`ï¼‰
- ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯é–‰ã˜ãªã„ï¼ˆ`onClose()` ã¯å‘¼ã°ã‚Œãªã„ï¼‰

#### ã‚¤ãƒ™ãƒ³ãƒˆç³»

##### 1. ä¿å­˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**: `handleSubmit` ãŒå®Ÿè¡Œã•ã‚Œã€`updateTask.mutate()` ãŒå‘¼ã°ã‚Œã‚‹

##### 2. ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**: `props.onClose()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹

##### 3. ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ãƒ»å„ªå…ˆåº¦ã®å…¥åŠ›å¤‰æ›´

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›æ¬„ã«ã€Œæ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚’å…¥åŠ›

**Then**: å…¥åŠ›æ¬„ã®å€¤ãŒã€Œæ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«ã€ã«æ›´æ–°ã•ã‚Œã‚‹ï¼ˆ`screen.getByLabelText('ã‚¿ã‚¤ãƒˆãƒ«').value === 'æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«'`ï¼‰

#### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹

##### 1. èª¬æ˜ãŒnullã®å ´åˆ

**Given**: ã‚¿ã‚¹ã‚¯ã®`description`ãŒ`null`

**When**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**Then**: èª¬æ˜å…¥åŠ›æ¬„ã¯ç©ºæ–‡å­—ã§åˆæœŸåŒ–ã•ã‚Œã‚‹ï¼ˆ`screen.getByLabelText('èª¬æ˜ï¼ˆMarkdownï¼‰').value === ''`ï¼‰

##### 2. å„ªå…ˆåº¦ãŒå¤‰æ›´ã•ã‚Œãªã„å ´åˆ

**Given**: ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

**When**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚¤ãƒˆãƒ«ã®ã¿å¤‰æ›´ã—ã€å„ªå…ˆåº¦ã¯å¤‰æ›´ã›ãšã«ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**Then**:
- `updateTask.mutate()` ã® `input` ã«ã¯å¤‰æ›´ã•ã‚ŒãŸã‚¿ã‚¤ãƒˆãƒ«ã¨ã€å¤‰æ›´ã•ã‚Œã¦ã„ãªã„èª¬æ˜ãƒ»å„ªå…ˆåº¦ãŒå«ã¾ã‚Œã‚‹
- å¼•æ•°: `{ id: task.id, input: { title: 'æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«', description: (å…ƒã®å€¤), priority: (å…ƒã®å€¤) } }`

### ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹Context-based DI

ğŸ”µ *frontend.md - Context-based DIãƒ‘ã‚¿ãƒ¼ãƒ³*

```typescript
const mockUseTaskMutations = mock(() => ({
  updateTask: {
    mutate: mockMutate,
    isPending: false,
  },
  createTask: { mutate: mock(() => {}), isPending: false },
  deleteTask: { mutate: mock(() => {}), isPending: false },
  changeStatus: { mutate: mock(() => {}), isPending: false },
}));

const mockUseTasks = mock(() => ({
  data: [],
  isLoading: false,
  error: null,
}));

render(
  <TaskServicesProvider
    services={{
      useTasks: mockUseTasks,
      useTaskMutations: mockUseTaskMutations,
    }}
  >
    <TaskEditModal task={mockTask} onClose={mockOnClose} />
  </TaskServicesProvider>
);
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

ğŸ”µ *TASK-1334å®Œäº†æ¡ä»¶*

- **ç›®æ¨™**: 100%
- **é‡ç‚¹é …ç›®**:
  - å…¨ã¦ã®æ­£å¸¸ç³»ãƒ•ãƒ­ãƒ¼
  - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼å‡¦ç†
  - APIã‚¨ãƒ©ãƒ¼å‡¦ç†
  - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
  - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ï¼ˆ`updateTask.isPending`ï¼‰

---

## 7. å®Ÿè£…ä¸Šã®æ³¨æ„äº‹é …

### å¿…é ˆäº‹é …

ğŸ”µ *CLAUDE.mdã€frontend.md*

1. **Props ã®æ˜ç¤ºçš„ä½¿ç”¨**: `props.task`, `props.onClose` ã®å½¢å¼ã‚’å³å®ˆ
2. **React.memo**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚å¿…é ˆ
3. **Context-based DI**: `useTaskServices()` ã‹ã‚‰ `useTaskMutations` ã‚’å–å¾—
4. **å‹å®‰å…¨æ€§**: TypeScript 5ã®å‹ãƒã‚§ãƒƒã‚¯ã‚’å³å®ˆ
5. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®**: `__tests__/TaskEditModal.test.tsx`
6. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®å‡¦ç†**: `updateTask.isPending` ã‚’åˆ©ç”¨ã—ãŸä¿å­˜ãƒœã‚¿ãƒ³ã®ç„¡åŠ¹åŒ–
7. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¨APIã‚¨ãƒ©ãƒ¼ã®è¡¨ç¤º

### æ¨å¥¨äº‹é …

ğŸŸ¡ *TaskCreateForm.tsxã€TaskItem.tsxã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³*

1. **ã‚³ãƒ¡ãƒ³ãƒˆè©³ç´°åº¦3**: ãƒŸãƒ‰ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç†è§£ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒ¡ãƒ³ãƒˆ
2. **Given-When-Then**: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¯æ—¥æœ¬èªã§è¨˜è¿°
3. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æ—¥æœ¬èªã§åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤º

### ç¦æ­¢äº‹é …

ğŸ”µ *CLAUDE.md*

1. **`mock.module()` ã®ä½¿ç”¨**: Context-based DIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
2. **`JSX.Element` å‹**: `React.ReactNode` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
3. **`any` å‹**: å‹ãŒå–å¾—ä¸èƒ½ãªå ´åˆã®ã¿ã€ç†ç”±ã‚³ãƒ¡ãƒ³ãƒˆä»˜ãã§ä½¿ç”¨å¯
4. **`var` ã®ä½¿ç”¨**: `const` ã¾ãŸã¯ `let` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
5. **ç›´æ¥ã®ãƒ•ãƒƒã‚¯import**: `useTaskMutations` ã‚’ç›´æ¥importã›ãšã€`useTaskServices()` çµŒç”±ã§å–å¾—ã™ã‚‹ã“ã¨

---

## 8. å°†æ¥çš„ãªæ‹¡å¼µ

### å„ªå…ˆåº¦: é«˜ï¼ˆç¾åœ¨ã¯åˆæœŸå®Ÿè£…ã§å¯¾å¿œæ¸ˆã¿ï¼‰

ğŸ”µ *TaskCreateForm.tsxã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³*

1. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºæ©Ÿèƒ½** âœ…
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è¡¨ç¤º
   - APIã‚¨ãƒ©ãƒ¼ã®è¡¨ç¤º
   - å†è©¦è¡Œãƒœã‚¿ãƒ³ã®è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰

2. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º** âœ…
   - `updateTask.isPending` ã‚’åˆ©ç”¨ã—ãŸä¿å­˜ãƒœã‚¿ãƒ³ã®ç„¡åŠ¹åŒ–
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ã®è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰

### å„ªå…ˆåº¦: ä¸­

ğŸ”´ *å°†æ¥çš„ãªæ‹¡å¼µã®æ¨æ¸¬*

1. **èª¬æ˜æ¬„ã®Markdownãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
   - Markdownã‚¨ãƒ‡ã‚£ã‚¿ã®å°å…¥

2. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´æ©Ÿèƒ½ã®è¿½åŠ **
   - ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚‚å¤‰æ›´å¯èƒ½ã«ã™ã‚‹
   - `changeStatus` ã¨ã®çµ±åˆ

### å„ªå…ˆåº¦: ä½

ğŸ”´ *UXå‘ä¸Šã®æ¨æ¸¬*

1. **ãƒ•ã‚©ãƒ¼ãƒ ã®å·®åˆ†æ¤œå‡º**
   - å¤‰æ›´ãŒãªã„å ´åˆã¯ä¿å­˜ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
   - æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®è­¦å‘Š

2. **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ**
   - Escã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
   - Ctrl+Enterã§ä¿å­˜

---

## 9. å‚è€ƒè³‡æ–™

### é–¢é€£å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

- [TaskCreateForm.tsx](../../../../app/client/src/features/todo/components/TaskCreateForm.tsx) - ãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£…ã®å‚è€ƒ
- [TaskItem.tsx](../../../../app/client/src/features/todo/components/TaskItem.tsx) - UIå®Ÿè£…ã®å‚è€ƒ
- [useTaskMutations.ts](../../../../app/client/src/features/todo/hooks/useTaskMutations.ts) - updateTaskå®Ÿè£…
- [TaskServicesContext.tsx](../../../../app/client/src/features/todo/lib/TaskServicesContext.tsx) - useTaskServiceså®Ÿè£…

### é–¢é€£ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

- [TaskCreateForm.test.tsx](../../../../app/client/src/features/todo/__tests__/TaskCreateForm.test.tsx) - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å‚è€ƒ
- [TaskItem.test.tsx](../../../../app/client/src/features/todo/__tests__/TaskItem.test.tsx) - ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®å‚è€ƒ

### é–¢é€£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- [CLAUDE.md](../../../../CLAUDE.md) - é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- [frontend.md](../../../.claude/skills/common/references/frontend.md) - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- [documents.md](../../../.claude/skills/common/references/documents.md) - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

---

## 10. ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | é’ä¿¡å·ğŸ”µ | é»„ä¿¡å·ğŸŸ¡ | èµ¤ä¿¡å·ğŸ”´ |
|-----------|---------|---------|---------|
| 1. æ©Ÿèƒ½ã®æ¦‚è¦ | âœ… | - | - |
| 2. å…¥åŠ›ãƒ»å‡ºåŠ›ã®ä»•æ§˜ | âœ… | âœ… | - |
| 3. åˆ¶ç´„æ¡ä»¶ | âœ… | - | âœ… (NFR-002é¡æ¨) |
| 4. æƒ³å®šã•ã‚Œã‚‹ä½¿ç”¨ä¾‹ | âœ… | âœ… | âœ… (propså¤‰æ›´) |

**ç·åˆè©•ä¾¡**: ğŸ”µ **é’ä¿¡å·ï¼ˆé«˜å“è³ªï¼‰**

- **è¦ä»¶ã®æ›–æ˜§ã•**: ãªã—ï¼ˆTASK-1334ã€REQ-002ã§æ˜ç¢ºï¼‰
- **å…¥å‡ºåŠ›å®šç¾©**: å®Œå…¨ï¼ˆTaskå‹ã€UpdateTaskBodyã§å®šç¾©æ¸ˆã¿ã€å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é€ä¿¡ã¨æ˜è¨˜ï¼‰
- **åˆ¶ç´„æ¡ä»¶**: æ˜ç¢ºï¼ˆRLSã€JWTã€Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€Context-based DIï¼‰
- **å®Ÿè£…å¯èƒ½æ€§**: ç¢ºå®Ÿï¼ˆæ—¢å­˜å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¸è¥²ã€useTaskServicesçµŒç”±ã§ãƒ•ãƒƒã‚¯å–å¾—ï¼‰

---

## 11. Codex MCPãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜äº‹é …ã¸ã®å¯¾å¿œ

### å¯¾å¿œæ¸ˆã¿

1. âœ… **Context-based DI**: `useTaskServices()` ã‹ã‚‰ãƒ•ãƒƒã‚¯ã‚’å–å¾—ã™ã‚‹è¨˜è¿°ã‚’è¿½åŠ 
2. âœ… **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹**: `updateTask.isPending` ã«ã‚ˆã‚‹ä¿å­˜ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ã‚’åˆæœŸå®Ÿè£…ã«å«ã‚ã‚‹
3. âœ… **å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é€ä¿¡**: UpdateTaskBodyã¯å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¸¸ã«é€ä¿¡ã™ã‚‹ã“ã¨ã‚’æ˜è¨˜
4. âœ… **NFR-002é¡æ¨**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ãŒã‚¿ã‚¹ã‚¯æ›´æ–°å°‚ç”¨ã§ã¯ãªã„ã“ã¨ã‚’æ˜è¨˜ï¼ˆğŸ”´èµ¤ä¿¡å·ï¼‰
5. âœ… **Given-When-Then**: å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’Given-When-Thenå½¢å¼ã§è©³ç´°è¨˜è¿°

### æœªå¯¾å¿œï¼ˆè¨­è¨ˆä¸Šã®åˆ¤æ–­ï¼‰

- **TASK-1334ã®exportå½¢å¼**: TASK-1334ã§ã¯`export const TaskEditModal`ã ãŒã€æœ¬ä»•æ§˜ã§ã¯`export default React.memo(TaskEditModal)`ã‚’æ¨å¥¨
  - ç†ç”±: æ—¢å­˜ã®`TaskCreateForm.tsx`ã¨ã®æ•´åˆæ€§ã€CLAUDE.mdã®æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æº–æ‹ 

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|------|-----------|---------|--------|
| 2025-12-15 | 1.0.0 | åˆç‰ˆä½œæˆ | tdd-requirements-skill |
| 2025-12-15 | 1.1.0 | Codex MCPãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜å¯¾å¿œï¼šContext-based DIã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã€å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é€ä¿¡ã€Given-When-Thenè©³ç´°åŒ– | tdd-requirements-skill |
