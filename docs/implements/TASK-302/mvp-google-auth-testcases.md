# TASK-302: ユーザープロフィール表示実装 - TDDテストケース一覧

## 開発言語・フレームワーク

### 🔵 **技術スタック**（既存環境確認済み）
- **プログラミング言語**: TypeScript 5
  - **言語選択の理由**: プロジェクト標準、型安全性確保、既存User型活用
  - **テストに適した機能**: 型ベースのモック作成、インターフェース検証
- **テストフレームワーク**: Bun Test + @testing-library/react + @testing-library/user-event
  - **フレームワーク選択の理由**: プロジェクト標準、高速実行、JSDOMサポート
  - **テスト実行環境**: Docker内clientコンテナ、`bun test --dom --preload ./src/test-setup.ts`

---

## 1. 正常系テストケース（基本的な動作）

### 1-1. ユーザープロフィール基本表示テスト
- **テスト名**: 認証済みユーザーの完全なプロフィール情報表示
  - **何をテストするか**: 全てのユーザー情報（名前・メール・アバター・最終ログイン日時）の正確な表示
  - **期待される動作**: User型オブジェクトの各プロパティが適切にUIにレンダリングされる
- **入力値**: 完全なUser型オブジェクト（`lastLoginAt`含む）
  ```typescript
  const mockUser: User = {
    id: '550e8400-e29b-41d4-a716-446655440000',
    name: '山田太郎',
    email: 'user@example.com',
    avatarUrl: 'https://example.com/avatar.jpg',
    lastLoginAt: '2025-09-01T10:30:00.000Z'
  }
  ```
  - **入力データの意味**: プロダクション環境で想定される標準的なユーザーデータ
- **期待される結果**: 
  - 名前「山田太郎」がh2見出しで表示
  - メールアドレス「user@example.com」がp要素で表示
  - アバター画像が64x64pxで表示、適切なalt属性設定
  - 最終ログイン日時が「2025年9月1日 19:30」形式で表示
  - **期待結果の理由**: UI/UX要件とアクセシビリティ基準への準拠
- **テストの目的**: 基本機能の完全動作確認
  - **確認ポイント**: 全データの正確な表示、適切なHTML構造、アクセシビリティ属性
- 🔵 **既存User型定義・実装パターンに基づく高信頼性**

### 1-2. ローディング状態表示テスト  
- **テスト名**: プロフィール取得中のスケルトンUI表示
  - **何をテストするか**: データ取得中の適切なローディング状態表示
  - **期待される動作**: データ取得処理中にユーザーフレンドリーなスケルトンUIが表示される
- **入力値**: `loading: true`状態のuseUserProfileフック
  - **入力データの意味**: API呼び出し中の非同期状態をシミュレート
- **期待される結果**: 
  - アバター用円形スケルトンプレースホルダー表示
  - 名前用長方形スケルトンプレースホルダー表示  
  - メール用長方形スケルトンプレースホルダー表示
  - 最終ログイン日時用スケルトンプレースホルダー表示
  - **期待結果の理由**: ユーザビリティ向上、体感パフォーマンス改善
- **テストの目的**: ローディング状態のUX品質確認
  - **確認ポイント**: スケルトンUI表示、適切なaria-labelによるローディング状態の通知
- 🟡 **チェックリスト要件から設計、妥当な推測**

### 1-3. レスポンシブ表示テスト
- **テスト名**: 各画面サイズでの適切なレイアウト表示
  - **何をテストするか**: タブレット・スマートフォンでの最適化表示
  - **期待される動作**: 画面サイズに応じて適切にレイアウトが調整される
- **入力値**: 
  - デスクトップ: 1024px幅
  - タブレット: 768px幅  
  - スマートフォン: 375px幅
  - **入力データの意味**: 主要なブレークポイントでの表示確認
- **期待される結果**: 
  - 各サイズで適切な余白・フォントサイズ
  - スマートフォンでアバターサイズ調整
  - 全画面サイズでテキストの可読性確保
  - **期待結果の理由**: レスポンシブ設計要件、ユーザビリティ確保
- **テストの目的**: モバイル対応の品質確認
  - **確認ポイント**: Tailwind CSSレスポンシブクラスの正しい適用
- 🔵 **チェックリスト明示要件による高信頼性**

---

## 2. 異常系テストケース（エラーハンドリング）

### 2-1. API通信エラーハンドリングテスト
- **テスト名**: バックエンドAPI通信失敗時のエラー表示と再試行機能
  - **エラーケースの概要**: `/api/user/profile`エンドポイントへの通信が失敗した場合
  - **エラー処理の重要性**: ユーザーにとって分かりやすいエラー表示と復旧手段の提供
- **入力値**: API呼び出しで`500 Internal Server Error`をモック
  - **不正な理由**: サーバー内部エラーによる一時的な通信障害
  - **実際の発生シナリオ**: サーバーメンテナンス中、データベース接続エラー時
- **期待される結果**: 
  - 「プロフィール情報の取得に失敗しました」エラーメッセージ表示
  - 「再試行」ボタンの表示
  - エラー状態のaria-liveアナウンス
  - **エラーメッセージの内容**: 技術的詳細を隠した分かりやすい日本語表現
  - **システムの安全性**: エラー時でもアプリケーション全体が動作可能
- **テストの目的**: エラーハンドリングの適切性確認
  - **品質保証の観点**: ユーザーが迷わず復旧できるUX設計
- 🟡 **一般的なAPI通信エラーパターンからの妥当な推測**

### 2-2. 認証エラーハンドリングテスト
- **テスト名**: JWT認証失敗時の適切なエラー処理
  - **エラーケースの概要**: 認証トークンの有効期限切れまたは改ざん検出
  - **エラー処理の重要性**: セキュリティ要件とユーザーガイダンスの両立
- **入力値**: `401 Unauthorized`レスポンスをモック
  - **不正な理由**: JWT有効期限切れ、不正なトークン
  - **実際の発生シナリオ**: 長時間アクセス後、別デバイスでログアウト後
- **期待される結果**: 
  - 「認証が必要です。再度ログインしてください」メッセージ表示
  - ログインページへの誘導リンク表示
  - セッション情報のクリア
  - **エラーメッセージの内容**: セキュリティを保ちつつユーザーフレンドリー
  - **システムの安全性**: 不正アクセス防止、適切な状態遷移
- **テストの目的**: セキュリティエラーハンドリング確認
  - **品質保証の観点**: セキュリティとユーザビリティの適切なバランス
- 🔵 **既存認証実装パターン（TASK-301）からの高信頼性**

### 2-3. ネットワークエラーハンドリングテスト
- **テスト名**: ネットワーク接続不良時のエラー処理
  - **エラーケースの概要**: インターネット接続断絶、DNS解決失敗
  - **エラー処理の重要性**: オフライン環境での適切なユーザーガイダンス
- **入力値**: `Network Error`例外をモック
  - **不正な理由**: ネットワーク接続の一時的または永続的な断絶
  - **実際の発生シナリオ**: WiFi切断、モバイル通信圏外、プロキシエラー
- **期待される結果**: 
  - 「インターネット接続を確認してください」メッセージ表示
  - 自動再試行（3回まで）の実行
  - オフライン状態の視覚的表示
  - **エラーメッセージの内容**: 技術的でないユーザー向け表現
  - **システムの安全性**: グレースフル・デグラデーション対応
- **テストの目的**: ネットワーク障害耐性の確認
  - **品質保証の観点**: モバイル環境での安定性確保
- 🟡 **一般的なネットワークエラーパターンからの妥当な推測**

---

## 3. 境界値テストケース（最小値、最大値、null等）

### 3-1. 長いユーザー名表示テスト
- **テスト名**: 50文字を超える長いユーザー名の適切な省略表示
  - **境界値の意味**: UI設計上の表示可能な文字数制限
  - **境界値での動作保証**: 長い名前でもレイアウト崩れを防ぐ
- **入力値**: 51文字のユーザー名「テストユーザーテストユーザーテストユーザーテストユーザーテストユーザーt」
  - **境界値選択の根拠**: EDGE-101要件（50文字以上の場合は適切に省略表示）
  - **実際の使用場面**: 外国人ユーザーのフルネーム、ニックネーム設定時
- **期待される結果**: 
  - 47文字 + "..."形式での省略表示
  - title属性による完全名の表示
  - レイアウト崩れの防止
  - **境界での正確性**: 正確な文字数カウント、適切な省略位置
  - **一貫した動作**: 各画面サイズで一貫した省略ルール
- **テストの目的**: UI設計境界での堅牢性確認
  - **堅牢性の確認**: 極端な入力値でのレイアウト保護
- 🔵 **EDGE-101要件明示による高信頼性**

### 3-2. アバター画像フォールバック処理テスト
- **テスト名**: アバター画像URL無効時のデフォルト画像表示
  - **境界値の意味**: 画像データの存在/非存在の境界
  - **境界値での動作保証**: 画像取得失敗時の適切な代替表示
- **入力値**: 
  - `avatarUrl: null`
  - `avatarUrl: "https://invalid-url.example.com/404.jpg"`
  - **境界値選択の根拠**: EDGE-102要件、実際の画像取得失敗パターン
  - **実際の使用場面**: 外部画像サーバー障害、画像削除、不正URL
- **期待される結果**: 
  - `/default-avatar.png`デフォルト画像の表示
  - 適切なalt属性「プロフィール画像」の設定
  - 画像読み込み失敗時の自動フォールバック
  - **境界での正確性**: エラー状態での確実な代替表示
  - **一貫した動作**: 全ての画像失敗パターンで同一処理
- **テストの目的**: 画像表示の境界条件確認
  - **堅牢性の確認**: 外部リソース依存での安定性確保
- 🔵 **既存実装確認済み + EDGE-102要件による高信頼性**

### 3-3. 空データ・null値処理テスト
- **テスト名**: 必須フィールド以外がnull/undefinedの場合の適切な表示
  - **境界値の意味**: データ完全性の境界、必須/任意フィールドの境界
  - **境界値での動作保証**: 不完全なデータでの安全な表示
- **入力値**: 
  ```typescript
  const incompleteUser: User = {
    id: '550e8400-e29b-41d4-a716-446655440000',
    name: '山田太郎',
    email: 'user@example.com',
    avatarUrl: null,
    lastLoginAt: null  // 境界値：初回ログイン時
  }
  ```
  - **境界値選択の根拠**: 新規ユーザー（初回ログイン）の状態
  - **実際の使用場面**: JITプロビジョニング直後、データ移行時
- **期待される結果**: 
  - 最終ログイン日時欄に「初回ログインです」メッセージ表示
  - デフォルトアバター画像の表示  
  - 他フィールドの正常表示
  - **境界での正確性**: null値の適切な判定と代替表示
  - **一貫した動作**: null値処理の統一ルール適用
- **テストの目的**: データ境界での安全性確認
  - **堅牢性の確認**: 不完全なデータでのアプリケーション動作保証
- 🟡 **新規ユーザーパターンからの妥当な推測**

---

## テストケース実装時の日本語コメント指針

### テストケース開始時のコメント
```typescript
// 【テスト目的】: TASK-302チェックリスト要件のプロフィール表示機能検証
// 【テスト内容】: ユーザー情報の完全な表示とローディング・エラー状態の確認
// 【期待される動作】: 全状態で適切なUI表示とアクセシビリティ確保
// 🔵🟡🔴 該当する信頼性レベルを記載
```

### Given（準備フェーズ）のコメント
```typescript
// 【テストデータ準備】: 本物に近いUser型データでリアルなテスト環境を構築
// 【初期条件設定】: useUserProfileフックの各状態を適切にモック
// 【前提条件確認】: 認証済み状態とAPIエンドポイントの可用性を確認
```

### When（実行フェーズ）のコメント
```typescript
// 【実際の処理実行】: UserProfileコンポーネントのレンダリング実行
// 【処理内容】: プロフィール情報の取得・表示・エラーハンドリングの一連の流れ
// 【実行タイミング】: コンポーネントマウント時の非同期処理開始
```

### Then（検証フェーズ）のコメント
```typescript
// 【結果検証】: 表示内容・アクセシビリティ・レスポンシブ対応の包括的確認
// 【期待値確認】: チェックリスト要件に対する完全な適合性検証
// 【品質保証】: プロダクション環境でのユーザビリティ・堅牢性保証
```

### 各expectステートメントのコメント
```typescript
// 【検証項目】: 最終ログイン日時の日本語ローカライズ表示確認
expect(screen.getByText('2025年9月1日 19:30')).toBeTruthy();

// 【検証項目】: アバター画像のアクセシビリティ属性確認
// 🔵 WCAG 2.1 AA準拠の既存実装パターンに基づく
expect(screen.getByRole('img', { name: /プロフィール画像/i })).toBeTruthy();

// 【検証項目】: エラー状態でのaria-live通知機能確認
// 🟡 一般的なエラーハンドリングパターンからの推測
expect(screen.getByRole('status')).toHaveAttribute('aria-live', 'polite');
```

### セットアップ・クリーンアップのコメント
```typescript
beforeEach(() => {
  // 【テスト前準備】: 各テストで独立した環境を構築し状態汚染を防止
  // 【環境初期化】: モック状態のリセットとDOMの初期化
});

afterEach(() => {
  // 【テスト後処理】: メモリリーク防止とグローバル状態のクリーンアップ
  // 【状態復元】: 次テスト実行への影響排除と安定した継続実行環境の維持
});
```
