# TASK-302: ユーザープロフィール表示実装 - TDD要件定義書

## 1. 機能の概要（EARS要件定義書・設計文書ベース）

### 🔵 **高信頼性要件**（チェックリスト明示）
- **機能概要**: 認証済みユーザーの詳細プロフィール情報を表示するコンポーネント
- **対象ユーザー**: 認証済みのアプリケーション利用者
- **解決する問題**: 現在の基本的なプロフィール表示をプロダクション品質に拡張
- **システム内位置**: フロントエンド認証フロー（TASK-301）の後続機能

### 🟡 **中信頼性要件**（既存設計から推測）
- **アーキテクチャ統合**: 既存のDDD + クリーンアーキテクチャとの整合
- **認証基盤活用**: 実装済みのJWT検証・Supabase認証システムとの連携

**参照したEARS要件**: REQ-005（バックエンドAPIは認証済みユーザーのプロフィール情報を返却）  
**参照した設計文書**: `/docs/design/mvp-google-auth/architecture.md`

## 2. 入力・出力の仕様（EARS機能要件・TypeScript型定義ベース）

### 🔵 **高信頼性仕様**（既存型定義確認済み）

**入力パラメータ**:
```typescript
// 既存のUser型を活用（@/packages/shared-schemas/src/auth）
interface User {
  id: string;
  externalId: string;
  provider: 'google';
  email: string;
  name: string;
  avatarUrl: string | null;
  createdAt: string;
  updatedAt: string;
  lastLoginAt: string;  // 新規表示対象
}
```

**出力仕様**:
- **正常表示**: ユーザー情報の完全な表示（アバター・名前・メール・最終ログイン日時）
- **ローディング状態**: スケルトンUI表示
- **エラー状態**: 再試行ボタン付きエラーメッセージ表示

### 🟡 **中信頼性仕様**（API設計から推測）
**API連携**:
- **エンドポイント**: `GET /api/user/profile`（既存UserController活用）
- **レスポンス形式**: JSON形式のUser型オブジェクト
- **認証**: JWT Bearer Token

**参照したEARS要件**: REQ-005  
**参照した設計文書**: `/docs/design/mvp-google-auth/interfaces.ts`

## 3. 制約条件（EARS非機能要件・アーキテクチャ設計ベース）

### 🔵 **高信頼性制約**（チェックリスト明示）
- **レスポンシブ要件**: タブレット・スマートフォン最適化必須
- **アクセシビリティ要件**: 画像alt属性・適切な見出し構造必須
- **テスト要件**: コンポーネント・APIモック・レスポンシブテスト必須

### 🟡 **中信頼性制約**（既存NFR要件から推測）
- **パフォーマンス**: API応答1秒以内（NFR-002準拠）
- **セキュリティ**: HTTPS通信・JWT認証必須（NFR-101,102準拠）
- **技術制約**: Tailwind CSS・Next.js 15・TypeScript使用

### 🔴 **推測制約**
- **ブラウザ対応**: モダンブラウザ対応（Chrome, Firefox, Safari, Edge最新版）

**参照したEARS要件**: NFR-002, NFR-101, NFR-102  
**参照した設計文書**: `/docs/design/mvp-google-auth/architecture.md`

## 4. 想定される使用例（EARSEdgeケース・データフローベース）

### 🔵 **高信頼性パターン**（チェックリスト明示）

**基本使用パターン**:
1. 認証済みユーザーがページにアクセス
2. ローディング状態（スケルトンUI）を表示
3. バックエンドAPI呼び出し
4. プロフィール情報の完全表示（名前・メール・アバター・最終ログイン日時）

**エラーケース**:
1. API通信エラー発生
2. 再試行ボタン付きエラーメッセージ表示
3. ユーザーが再試行ボタンをクリック
4. 再度API呼び出し実行

### 🟡 **中信頼性エッジケース**（既存実装から推測）
- **アバター画像取得失敗**: デフォルト画像表示（既存実装済み）
- **長いユーザー名**: 適切な省略表示（EDGE-101準拠）

**参照したEARS要件**: EDGE-101, EDGE-102  
**参照した設計文書**: `/docs/design/mvp-google-auth/dataflow.md`

## 5. EARS要件・設計文書との対応関係

### 参照した要件・設計文書
- **参照したユーザストーリー**: ストーリー2（バックエンドAPIでのユーザー情報取得）
- **参照した機能要件**: REQ-005
- **参照した非機能要件**: NFR-002, NFR-101, NFR-102
- **参照したEdgeケース**: EDGE-101, EDGE-102
- **参照した受け入れ基準**: ユーザー情報を取得して画面に表示される
- **参照した設計文書**:
  - **アーキテクチャ**: architecture.md（クリーンアーキテクチャ準拠）
  - **データフロー**: dataflow.md（認証後のユーザー情報取得フロー）
  - **型定義**: interfaces.ts（User型定義）
  - **API仕様**: 既存UserController（プロフィール取得エンドポイント）

## TASK-302固有の追加要件

### 新規アーキテクチャ要件
- **features/user**ディレクトリ新設による機能分離
- **useUserProfile**カスタムフック実装
- **userService**API連携レイヤー実装

### UI/UX品質要件
- **スケルトンUI**: ローディング時の適切なプレースホルダー表示
- **エラーリカバリ**: ユーザビリティを考慮した再試行機能
- **モバイルファースト**: レスポンシブデザイン最優先

## 品質判定

✅ **高品質**:
- 要件の曖昧さ: なし（チェックリストで明確に定義）
- 入出力定義: 完全（既存User型活用）
- 制約条件: 明確（技術スタック・品質要件明示）
- 実装可能性: 確実（既存基盤活用による拡張）

## 実装戦略

### フェーズ1: アーキテクチャ基盤構築
1. **features/user**ディレクトリ構造作成
2. **userService.ts**API連携レイヤー実装
3. **useUserProfile.tsx**カスタムフック実装

### フェーズ2: UI/UXコンポーネント拡張
4. 既存UserProfileコンポーネントの移設・拡張
5. スケルトンUI・エラーハンドリング実装
6. レスポンシブ・アクセシビリティ対応

### フェーズ3: 品質確保・テスト実装
7. 包括的コンポーネントテスト作成
8. APIモックテスト実装
9. レスポンシブテスト実装
