# MVP Google認証 フロントエンド実装タスク

作成日: 2025-08-30
更新日: 2025-08-30

## 概要

フロントエンド担当タスク: 4タスク（TASK-301〜TASK-402）
推定作業時間: 1.5時間以内
クリティカルパス: TASK-301 → TASK-302 → TASK-401 → TASK-402

## 技術スタック

- **フレームワーク**: Next.js 15 + TypeScript 5
- **パッケージ管理**: Bun
- **テスト**: Bun 標準
- **状態管理**: Redux
- **スタイリング**: Tailwind CSS
- **認証**: Supabase Auth + Google OAuth

## タスク一覧

### フェーズ6: フロントエンド実装

#### TASK-301: 認証フロー実装（フロントエンド）

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: フロントエンド技術スタック、認証フロー仕様
- **依存タスク**: TASK-201（バックエンド認証API）, TASK-202（ユーザーAPI）
- **実装詳細**:
  - Supabase Auth の設定
  - Google OAuth フローの実装
  - JWT取得・保存
  - 認証状態管理（Redux）
- **ファイル構成**:
  ```
  app/client/src/
  ├── features/auth/
  │   ├── components/
  │   │   ├── LoginButton.tsx
  │   │   └── LogoutButton.tsx
  │   ├── hooks/
  │   │   └── useAuth.tsx
  │   ├── store/
  │   │   ├── authSlice.ts
  │   │   └── authActions.ts
  │   └── services/
  │       └── authService.ts
  └── lib/
      └── supabase.ts
  ```
- **機能実装**:
  - Google OAuth によるログイン
  - JWT の自動取得・保存
  - ログアウト機能
  - 認証状態の永続化
- **UI/UX要件**:
  - [ ] ローディング状態: ログインボタン無効化 + スピナー
  - [ ] エラー表示: トースト通知またはインラインエラー
  - [ ] モバイル対応: レスポンシブデザインでの適切表示
  - [ ] アクセシビリティ: キーボード操作・ARIA属性対応
- **テスト要件**:
  - [ ] コンポーネントテスト: LoginButton・LogoutButton
  - [ ] ストアテスト: authSlice の状態変更
  - [ ] 統合テスト: 認証フロー全体のE2E

#### TASK-302: ユーザープロフィール表示実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: フロントエンド技術スタック、API連携仕様
- **依存タスク**: TASK-301
- **実装詳細**:
  - ユーザープロフィール表示コンポーネント
  - バックエンドAPI との連携
  - 認証済み状態でのデータ取得
  - エラーハンドリング
- **ファイル構成**:
  ```
  app/client/src/
  └── features/user/
      ├── components/
      │   └── UserProfile.tsx
      ├── hooks/
      │   └── useUserProfile.tsx
      └── services/
          └── userService.ts
  ```
- **機能実装**:
  - 認証後のユーザー情報表示
  - アバター画像の表示
  - ユーザー名・メールアドレス表示
  - 最終ログイン日時表示
- **UI/UX要件**:
  - [ ] ローディング状態: スケルトンUI表示
  - [ ] エラー表示: 再試行ボタン付きエラーメッセージ
  - [ ] モバイル対応: タブレット・スマートフォン最適化
  - [ ] アクセシビリティ: 画像のalt属性・適切な見出し構造
- **テスト要件**:
  - [ ] コンポーネントテスト: 各状態での適切な表示
  - [ ] APIモックテスト: 成功・失敗レスポンスのハンドリング
  - [ ] レスポンシブテスト: 異なる画面サイズでの表示確認

### フェーズ7: 統合・品質保証

#### TASK-401: E2Eテストスイート実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: 全体フロー仕様、品質要件
- **依存タスク**: TASK-302
- **実装詳細**:
  - Playwright を使用したE2Eテスト
  - 主要ユーザーフローのテスト自動化
  - CI/CD パイプラインとの統合
- **テストシナリオ**:
  - [ ] 初回ログインフロー（JITプロビジョニング）
  - [ ] 2回目以降ログインフロー（既存ユーザー）
  - [ ] ログアウトフロー
  - [ ] 認証エラー時のハンドリング
  - [ ] ページリロード時の認証状態復元
- **テスト環境**:
  - テスト用Supabaseプロジェクト
  - テスト用データベース
  - モック化されたGoogle OAuth
- **パフォーマンステスト**:
  - [ ] 認証フロー全体: 10秒以内
  - [ ] JWT検証: 1秒以内
  - [ ] JITプロビジョニング: 2秒以内
  - [ ] ユーザー情報取得: 500ms以内

#### TASK-402: 型安全性・品質確認

- [ ] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: TypeScript設定、品質要件
- **依存タスク**: TASK-401
- **実装詳細**:
  - TypeScript型チェック（--noEmit）
  - Biome による静的解析・フォーマット
  - 全テストスイートの実行
  - パフォーマンス指標の確認
- **確認項目**:
  - [ ] フロントエンド型チェック通過
  - [ ] 全単体テスト通過
  - [ ] 全統合テスト通過
  - [ ] 全E2Eテスト通過
  - [ ] Biome リント・フォーマット通過
- **品質ゲート**:
  - TypeScript strict mode 準拠
  - テストカバレッジ 80% 以上
  - レスポンス時間目標値クリア
  - アクセシビリティ要件充足
- **確認コマンド**:
  ```bash
  # フロントエンド型チェック
  docker compose exec client bunx tsc --noEmit
  
  # テスト実行
  docker compose exec client bun test
  
  # 静的解析
  docker compose exec client bunx biome check .
  
  # 開発サーバー起動
  docker compose exec client bun run dev
  ```

## フィーチャーベースディレクトリ構造

```
app/client/src/
├── features/
│   ├── auth/               # 認証機能
│   │   ├── components/     # 認証関連コンポーネント
│   │   ├── hooks/          # 認証カスタムフック
│   │   ├── store/          # 認証状態管理
│   │   └── services/       # 認証API呼び出し
│   └── user/               # ユーザー機能
│       ├── components/     # ユーザー関連コンポーネント
│       ├── hooks/          # ユーザーカスタムフック
│       └── services/       # ユーザーAPI呼び出し
├── lib/                    # 共通ライブラリ
│   ├── supabase.ts        # Supabaseクライアント
│   └── api.ts             # APIクライアント設定
├── store/                  # グローバル状態管理
│   ├── index.ts           # Store設定
│   └── rootReducer.ts     # ルートリデューサー
└── types/                  # 型定義
    └── auth.ts            # 認証関連型定義
```

## コード品質要件

### 必須要件
- **テスト駆動開発**: 実装前にテストケース作成
- **TypeScript**: 全面的な型安全性確保
- **日本語テストケース名**: テストの意図を明確に
- **ファイル末尾改行**: 全ファイルに空行追加

### 推奨要件
- **1行80文字以内**: 可読性向上のための改行
- **const使用**: 不変性を重視
- **コンポーネント分割**: 単一責任の原則

### 禁止事項
- **@ts-ignore**: @ts-expect-errorで代用
- **any型**: 明確な理由なく使用禁止
- **data-testid**: セマンティックな要素選択を優先
- **JSX.Element**: React.ReactNodeで代用

## セキュリティ要件

### フロントエンド
- JWTトークンの適切な保存（今回はlocalStorage）
- XSS対策: 適切なエスケープ処理
- CSRF対策: SameSite Cookie属性
- HTTPS通信の強制

### 認証フロー
- OAuth認可コードフロー準拠
- 状態管理でのトークン漏洩防止
- セッション管理の適切な実装

## 完了確認

### 機能確認
- [ ] Google OAuth によるログインが可能
- [ ] ユーザー情報が正しく表示される
- [ ] ログアウトが正常に動作する
- [ ] 認証状態がページリロード後も維持される

### 品質確認
- [ ] 全テストが通過する
- [ ] TypeScript型チェックが通過する
- [ ] パフォーマンス目標を満たす
- [ ] アクセシビリティ要件を満たす

### レスポンシブ対応
- [ ] デスクトップ表示の確認
- [ ] タブレット表示の確認  
- [ ] スマートフォン表示の確認

## トラブルシューティング

### Supabase接続エラー
- **原因**: 環境変数の設定不備
- **対処**: `.env.local` の確認・Supabaseプロジェクト設定確認

### Google OAuth エラー
- **原因**: OAuth設定の不備
- **対処**: Google Cloud Console・Supabase設定確認

### Redux状態管理エラー
- **原因**: アクション・リデューサーの型不整合
- **対処**: TypeScript型定義の確認・修正

### ビルドエラー
- **原因**: Next.js設定・依存関係の問題
- **対処**: `next.config.js` 確認・パッケージ更新

---

**次のステップ**: フロントエンド実装完了後は、バックエンドとの統合テストを実施し、全体的なユーザー体験を確認します。