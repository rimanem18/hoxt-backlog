ここから下に TODO を記載

# GitHub Actions で CI 構築

## E2Eテストスイート構築・修正履歴 (HOXBL-15 #25)

### ✅ 解決済み問題

#### 1. Firefox起動問題の解決
- **問題**: CI環境でFirefox起動時に`$HOME`ディレクトリ権限エラー
- **原因**: GitHub Actionsの`/github/home`がuid 1001所有でrootアクセス不可
- **解決**: container.envとstep環境変数の両方で`HOME=/root`を明示設定
- **結果**: 12件のFirefoxテスト失敗が完全解決

#### 2. Node.js v22互換性対応
- **問題**: `--loader tsx/esm`による循環参照エラー`ERR_REQUIRE_CYCLE_MODULE`
- **原因**: Node.js v20.6.0以降で`--loader`非推奨、v22で厳格化
- **解決**: `--import tsx`への変更でNode.js v22標準仕様に対応
- **結果**: サーバー起動エラーが解決、本番環境互換性チェック実現

#### 3. CI実行時間最適化の検討と回帰
- **検討**: docker/build-push-actionによるPlaywrightイメージキャッシュ実装
- **判断**: 専門家助言によりKISS原則でシンプルなcontainer方式に回帰
- **結果**: 過剰エンジニアリングを回避、保守性を優先

#### 4. T005無効JWT認証テストの修正
- **問題**: CI環境でログインボタンが見つからない（認証エラー未発生）
- **原因1**: 無効JWTが実際にはトークン不存在、Redux状態強制認証済み
- **修正1**: 期限切れの実JWTトークン設定、Redux初期状態を未認証に変更
- **原因2**: 認証エラー処理完了前にログインボタンを探索
- **修正2**: Promise.race()で認証エラー処理完了まで適切に待機

### 🔄 現在の課題

#### Firefox特有のページリロード問題 (NEW)
- **問題**: T004, T007テストでFirefoxのpage.reload()がタイムアウト
- **症状**: 30秒タイムアウト、navigationがload状態に到達しない
- **影響**: ローカル環境でも発生、Firefox特有の問題と推測
- **状況**: 22/24テストが成功、残り2件がFirefox固有問題

### 📊 達成状況
- **全体成功率**: 92% (22/24テスト成功)
- **Chromium**: 100% (12/12テスト成功)
- **Firefox**: 83% (10/12テスト成功)
- **修正対象**: Firefox特有のリロード処理問題

### 🎯 次のアクション
1. Firefoxページリロードタイムアウト問題の調査
2. waitForLoadStateの戦略変更またはFirefox固有対応
3. 100%テスト成功率の達成