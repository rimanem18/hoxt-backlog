---
description: 要件名と機能名を渡し、実装されたコードの理解を促進するための解説文書を作成する。
---

与えられた要件名・TASK-ID をもとに、**ジュニアエンジニアがコードを理解し、他者に説明できるレベル**の解説文書を作成してください。  
対象読者は、新しく組織に加入したばかりの初学者エンジニアです。
文章は「自分が後輩に説明している」と仮定し、平易で分かりやすく、段階的に理解できるようにしてください。

## 実行内容

### 1. 要件の分析

- 要件定義書 `docs/spec/{要件名}-requirements.md` を読み込む
- 今回の機能が「何を解決するものか」を簡潔に整理する。

### 2. 設計文書の確認

次の設計資料を確認し、コードの背景を把握する:

- `docs/design/{要件名}/architecture.md`
- `docs/design/{要件名}/database-schema.sql`
- `docs/design/{要件名}/api-endpoints.md`
- `docs/design/{要件名}/interfaces.ts`
- `docs/design/{要件名}/dataflow.md`

### 3. 実装コードの把握

- `docs/tasks/{要件名}-tasks.md` を確認し、対象 TASK を特定する。
- `{TASK-ID}` に紐づく実装ファイルを追跡し、コード全体の構造を理解する。

### 4. 解説文書の作成

出力ファイル:

- `docs/explan/{要件名}/{TASK-ID}-code-explan.md`
- フォルダがなければ新規作成する。

解説文書の要件:

- **必須**: クラスや関数の呼び出し関係を **mermaid 記法** で図示する。
- **必須**: 「どのファイルがどの役割を果たしているか」を明確に説明する。
- **必須**: コードを引用するまたは強く関連する解説をするとき、ディレクトリパスとファイル名を添える。
- **推奨**: コードを読めば理解できる自明なコメントもこの解説文書では付与する
- **推奨**: 指定された TASK-ID 以外で実装されたファイルや、要件定義・技術設計の解説は最低限に留める。
- **推奨**: 初学者がつまずきやすい誤解やミスを都度指摘する。
- **推奨**: 専門用語は最初に出てきた際に一度だけ簡単に説明する。
- **任意**: 比喩や実生活の例を交えてわかりやすくする。
- **禁止**: メソッド内部の処理を逐一書き出し、必要以上に詳細化。

## 文体・出力品質の指針

- 難しい言葉は避け、できるだけ「会話調に近い説明文」で書く。
- 読み手が「自分でも説明できそう」と感じる文章を目指す。
- 各セクションごとに見出しをつけて構造化する。
- 長文よりも段階的で理解の流れが追いやすい形にする。
- 「なぜこの設計や実装になっているか」という背景も補足する。
- 要件定義や技術設計ではなく、コードの説明であることを重視する。

## 出力フォーマット例

````md
## この機能が何を解決するのか

この機能は「{簡潔な説明}」ことを解決します。

具体的には：
- {具体的な処理フローを並べる}

これを「{難しい用語}」と呼び、{できること}ができます。

## 全体の処理の流れ

### 処理フローとファイル関係

{mermaid でシーケンスを図解（ここではディレクトリパスは省き、ファイル名などのみ記載）}

## ファイルの役割と責任

### 今回解説するメインのファイル
{TASK-ID で実装されたファイルの概要}
{実装された関数など説明}

### {呼び出しまたは呼び出されているファイル}
{ファイルの関数の説明}
{呼び出しているまたは呼び出されている関数など説明}

## クラスと関数の呼び出し関係

### クラス構造と依存関係
{mermaid でクラス図を図解（依存方向がわかりやすくになるように）}

## 重要な処理の詳細解説

{最低限理解すべき重要な処理をいくつかあげ、解説をする}

```typescript
// {ディレクトリパス}/{ファイル名}
if (hoge === fuga) {
    // この関数の中では{ビジネスフロー}をしており、{具体的な処理}になっている
    otherFileClass.piyo()
}
```

{この処理が必要である理由や押さえるべきポイントを説明}
{よくある勘違いを説明し、正しい理解へ導く}

## 初学者がつまずきやすいポイント

{わかりづらい用語などを噛み砕き、詳細解説よりもさらに初心者向けに説明}

## この設計のいい点

{このタスクで記述されたコードに直接関連する範囲内で設計のいい点を2つ〜4つほどあげる}

````

### mermaid で図示する際の注意事項

mermaidクラス図を記述する際の確認項目：

  - 波括弧 {} を直接使用していない
  - パイプ | を型定義で使用していない
  - 疑問符 ? をオプショナル表記で使用していない
  - ドット記法 object.method を避けている
  - 複雑なジェネリクスを単純な型名に置き換えている
  - Union Typesを意味のある型名に変換している
  - **型定義でコロン `:` を使用しない** (`+property: string` → `+property string`)
  - **日本語のメソッド名や特殊文字を避ける** (パースエラーの原因となる)
  - **関係線は単純な記法を使用** (`-->` 推奨、`||--o` や `||--||` などの複雑な記法は避ける)
  - **クラス名・プロパティ名・メソッド名は英数字のみ使用**

これらのルールに従うことで、mermaidクラス図のパースエラーを防ぎ、初学者にも理解しやすい図を作成できます。
