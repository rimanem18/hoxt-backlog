---
description: 要件定義や技術設計をもとにしたコードレビュー
---

## 事前確認

- レビューしてもらうべきファイルを確認します。明確でない場合は、ユーザに確認してください。
- 必要なガイドラインがなにか検討します。 Read ツールで読み込む必要はありません。ファイルパスを渡してください。

- **必須**: `CLAUDE.md`
- [バックエンド開発ガイドライン](../skills/common/references/backend.md)
- [フロントエンド開発ガイドライン](../skills/common/references/frontend.md)
- [スキーマ駆動開発ガイドライン](../skills/common/references/schema-db.md)
- [E2Eテストガイドライン](../skills/common/references/e2e.md)

## 実行内容

Codex MCP を使用してレビューを依頼します。
  - {at-mark}/filepath でファイル情報を渡すことができます。
  - 提案をしてもらう際は5段階評価を依頼し、その理由も添えるよう求めてください。

以下の観点で評価を依頼します。
  - 既存コードとの整合性
  - 各ガイドラインおよび CLAUDE.md のルールに正しく従っているかの観点
  - パフォーマンス
  - コード品質
  - セキュリティ
  - アクセシビリティ
  - テスタビリティ
  - メンテナンス性

4. レビューによって機能や品質、セキュリティに問題が見つかったか？
  - Yes
    -> 改善する（対応推奨度5のものは、自動的に反映してください）
  - No
    -> ユーザーに成果物の確認を促す。

5. レビュー後の改善に関して

- **対応必須**: 機能が壊れていたら修正
- **対応推奨**: 不要なコードの削除
- **対応推奨**: 実施時間に見合った提案の取り入れ
- **対応任意**: 必要最低限の Why のコメント記載
- **対応非推奨**: 実施時間に見合わない品質向上
- **対応禁止**: ついでに機能を追加

6. 改めて、test と lint, 型チェック, semgrep を実施します。問題があれば修正します。
  - `docker compose exec {コンテナサービス名} bunx tsc --noEmit`
  - `docker compose exec {コンテナサービス名} bun run fix`
  - `docker compose exec {コンテナサービス名} test`
  - `docker compose run --rm semgrep semgrep <args...>`

## 実行後のサマリー出力


レビューを受けたあとは、ユーザーにサマリーを表示し、どう対応するか推奨案を提示して、待機してください。

````

【実装サマリー】

- {サマリーを出力}

【Codex提案の対応必要性評価】

以下の提案がありましたが、対応は見送りました。

  1. Selector の分離

  対応推奨度: ⭐

  - 提案: memoized selectors のエクスポート
  - 評価理由:
    - 現状のstate構造は極めてシンプル（filters.priority, filters.status, sort.sortBy）
    - パフォーマンス問題は発生していない
    - 実際に複雑な算出ロジックが必要になった時点で実装すべき（YAGNI原則）
  - 判断: 対応不要

  ---
  2. resetFilters のクローン化

  対応推奨度: ⭐

  - 提案: state.filters = { ...initialState.filters } でクローン
  - 評価理由:
    - Redux Toolkit の Immer は内部で不変性を完全に保証
    - 現在の実装で参照共有の問題は発生しない
    - 過剰な防御的プログラミングはコードを冗長にする
  - 判断: 対応不要

  ---
  3. TaskSortBy 型の集約

  対応推奨度: ⭐⭐

  - 提案: sortBy のリテラル型を const 配列から派生
  - 評価理由:
    - 現在は3つのみで管理コストは低い
    - shared-schemas に TaskSort 型が既に存在する可能性あり
    - 型の一元管理は将来的に有用だが、現時点では緊急性なし
  - 判断: 優先度低（Phase 7 UI実装時に検討）

  ---
  4. typed hooks のエクスポート

  対応推奨度: ⭐⭐⭐⭐

  - 提案: useAppDispatch, useAppSelector の追加
  - 評価理由:
    - 既存の auth/error/oauthError slices でも型付きhooksを使用していない
    - プロジェクト全体で一貫性がない状態
    - ただし、今後のUI実装（Phase 7）で多用する前に導入すべき
  - 判断: Phase 7開始前に別タスクとして対応推奨

  {以下、同じようなフォーマットで出力}


対応推奨度⭐⭐⭐⭐の内容がn個あります。対応しますか？

- {内容をリストにして推奨アプローチを示してください}
````
