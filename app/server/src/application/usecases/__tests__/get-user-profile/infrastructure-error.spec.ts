/**
 * GetUserProfileUseCase ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ
 *
 * ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚„ãã®ä»–ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ã‚¤ãƒ¤ãƒ¼éšœå®³ã«å¯¾ã™ã‚‹
 * InfrastructureErrorå‡¦ç†ã‚’æ¤œè¨¼ã€‚ã‚·ã‚¹ãƒ†ãƒ éšœå®³æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ä¼æ’­ã‚’ç¢ºèªã€‚
 */

import { beforeEach, describe, test } from 'bun:test';
import { makeSUT } from './helpers/makeSUT';
import { GetUserProfileTestMatchers } from './helpers/matchers';
import { UserProfileFactory } from './helpers/userFactory';

describe('GetUserProfileUseCase ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ', () => {
  let sut: ReturnType<typeof makeSUT>;

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«SUTï¼ˆãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã‚’åˆæœŸåŒ–
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆã«ç‰¹åŒ–ã—ãŸã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    sut = makeSUT();
  });

  describe('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼', () => {
    test('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—ã§InfrastructureErrorãŒç™ºç”Ÿã™ã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã«InfrastructureErrorãŒé©åˆ‡ã«ç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: userRepository.findById() ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ãŸéš›ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: InfrastructureErrorãŒç™ºç”Ÿã—ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯è¦ä»¶å®šç¾©ã§æ˜ç¢ºã«è¦å®šã•ã‚Œã¦ã„ã‚‹

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆç”¨ã®æœ‰åŠ¹ãªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒªãƒã‚¸ãƒˆãƒªãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹ã‚ˆã†ã«è¨­å®š
      const validInput = UserProfileFactory.validInput();

      // ãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒƒã‚¯ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹ã‚ˆã†ã«è¨­å®š
      const mockFindById = sut.userRepository.findById as unknown as {
        mockRejectedValue: (error: Error) => void;
      };
      const databaseError = new Error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ');
      mockFindById.mockRejectedValue(databaseError);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹çŠ¶æ³ã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†ã‚’å®Ÿè¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«InfrastructureErrorã¨ã—ã¦å¤‰æ›ã™ã‚‹å‡¦ç†
      const promise = sut.sut.execute(validInput);

      // ã€çµæœæ¤œè¨¼ã€‘: é©åˆ‡ãªInfrastructureErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒInfrastructureErrorã¨ã—ã¦é©åˆ‡ã«å¤‰æ›ã•ã‚Œã‚‹
      await GetUserProfileTestMatchers.failWithError(promise, 'infrastructure'); // ã€ç¢ºèªå†…å®¹ã€‘: InfrastructureErrorã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢

      await GetUserProfileTestMatchers.failWithMessage(
        promise,
        'ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢

      // ä¾å­˜é–¢ä¿‚ã®å‘¼ã³å‡ºã—ç¢ºèª
      GetUserProfileTestMatchers.mock.toHaveBeenCalledWithUserId(
        sut.userRepository.findById,
        validInput.userId
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒªãƒã‚¸ãƒˆãƒªãŒæ­£ã—ã„userIdã§å‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª ğŸŸ¢

      GetUserProfileTestMatchers.mock.toHaveBeenCalledTimes(sut.userRepository.findById, 1); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã§ã‚‚ãƒªãƒã‚¸ãƒˆãƒªãŒ1å›ã ã‘å‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼', () => {
    test.each([
      ['ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼', new Error('Out of memory')],
      ['ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼', new Error('File system full')],
      ['ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ', new Error('Network timeout')],
      ['æ¨©é™ã‚¨ãƒ©ãƒ¼', new Error('Permission denied')],
    ])(
      '%s ã§InfrastructureErrorãŒç™ºç”Ÿã™ã‚‹',
      async (_description, systemError) => {
        // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ§˜ã€…ãªã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã«å¯¾ã—ã¦ä¸€è²«ã—ã¦InfrastructureErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ç•°ãªã‚‹ç¨®é¡ã®ã‚¤ãƒ³ãƒ•ãƒ©éšœå®³ã«å¯¾ã™ã‚‹çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: åŸå› ã®é•ã„ã«ã‚ˆã‚‰ãšã€InfrastructureErrorã¨ã—ã¦é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
        // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: æ§˜ã€…ãªã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã®ç¶²ç¾…çš„ãƒ†ã‚¹ãƒˆã¯è¦ä»¶å®šç¾©ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬ã¨ã—ã¦å®Ÿè£…

        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆç”¨ã®æœ‰åŠ¹ãªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
        // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: å„ç¨®ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒƒã‚¯è¨­å®š
        const validInput = UserProfileFactory.validInput();

        const mockFindById = sut.userRepository.findById as unknown as {
          mockRejectedValue: (error: Error) => void;
        };
        mockFindById.mockRejectedValue(systemError);

        // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å„ç¨®ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹çŠ¶æ³ã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†ã‚’å®Ÿè¡Œ
        // ã€å‡¦ç†å†…å®¹ã€‘: ç•°ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒçµ±ä¸€ã•ã‚ŒãŸInfrastructureErrorã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹
        const promise = sut.sut.execute(validInput);

        // ã€çµæœæ¤œè¨¼ã€‘: ã™ã¹ã¦ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã§ä¸€è²«ã—ãŸInfrastructureErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«ã‚ˆã‚‰ãšInfrastructureErrorãŒé©åˆ‡ã«ç™ºç”Ÿã™ã‚‹
        await GetUserProfileTestMatchers.failWithError(promise, 'infrastructure'); // ã€ç¢ºèªå†…å®¹ã€‘: å…¨ç¨®é¡ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã§InfrastructureErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡

        await GetUserProfileTestMatchers.failWithMessage(
          promise,
          'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
        ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡
      },
    );
  });

  describe('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¢é€£ã‚¨ãƒ©ãƒ¼', () => {
    test('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§InfrastructureErrorãŒç™ºç”Ÿã™ã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã—ãŸå ´åˆã«InfrastructureErrorãŒé©åˆ‡ã«ç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: é•·æ™‚é–“ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œã«å¯¾ã™ã‚‹ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«InfrastructureErrorã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å‡¦ç†ã¯è¦ä»¶å®šç¾©ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬ã¨ã—ã¦å®Ÿè£…

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆç”¨ã®æœ‰åŠ¹ãªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒƒã‚¯è¨­å®š
      const validInput = UserProfileFactory.validInput();

      const mockFindById = sut.userRepository.findById as unknown as {
        mockRejectedValue: (error: Error) => void;
      };
      const timeoutError = new Error('Query execution timeout');
      mockFindById.mockRejectedValue(timeoutError);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã™ã‚‹çŠ¶æ³ã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†ã‚’å®Ÿè¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«InfrastructureErrorã¨ã—ã¦å‡¦ç†
      const promise = sut.sut.execute(validInput);

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«InfrastructureErrorã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç‰¹æœ‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæä¾›ã•ã‚Œã‚‹
      await GetUserProfileTestMatchers.failWithError(promise, 'infrastructure'); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§ã‚‚InfrastructureErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡

      await GetUserProfileTestMatchers.failWithMessage(
        promise,
        'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼'
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«å¯¾ã™ã‚‹é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡
    });
  });

  describe('ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°æ¤œè¨¼', () => {
    test('ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼æ™‚ã«é©åˆ‡ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«é‹ç”¨ç›£è¦–ã«å¿…è¦ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©éšœå®³æ™‚ã®errorãƒ¬ãƒ™ãƒ«ãƒ­ã‚°ã¨éšœå®³è©³ç´°æƒ…å ±ãŒé©åˆ‡ã«è¨˜éŒ²ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¤ãƒ³ãƒ•ãƒ©éšœå®³ã®è©³ç´°ãŒãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã€é‹ç”¨æ™‚ã®éšœå®³å¯¾å¿œãŒå¯èƒ½ã«ãªã‚‹
      // ğŸ”´ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è©³ç´°ä»•æ§˜ã¯è¦ä»¶å®šç¾©ã«ãªã„ãŒã€é‹ç”¨ä¸Šé‡è¦ã¨åˆ¤æ–­

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°æ¤œè¨¼ç”¨ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã¨ãƒ­ã‚°å‡ºåŠ›ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®è¨­å®š
      const validInput = UserProfileFactory.validInput('uuid-infra-error-log-test');
      const infraError = new Error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šéšœå®³');

      const mockFindById = sut.userRepository.findById as unknown as {
        mockRejectedValue: (error: Error) => void;
      };
      mockFindById.mockRejectedValue(infraError);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›ã‚’å«ã‚€å‡¦ç†
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ­ã‚°å‡ºåŠ›æ©Ÿèƒ½ã‚’æŒã¤UseCaseã§ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè¡Œ
      try {
        await sut.sut.execute(validInput);
      } catch {
        // ã‚¨ãƒ©ãƒ¼ã¯æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ
      }

      // ã€çµæœæ¤œè¨¼ã€‘: æœŸå¾…ã•ã‚Œã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: errorãƒ¬ãƒ™ãƒ«ã§ã®é©åˆ‡ãªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨éšœå®³è©³ç´°ã®å‡ºåŠ›ã‚’ç¢ºèª
      GetUserProfileTestMatchers.haveLoggedMessage(
        sut.logger,
        'error',
        'Infrastructure error occurred during user profile retrieval',
        {
          userId: validInput.userId,
          error: infraError.message,
        }
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒéšœå®³è©³ç´°ã¨å…±ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸ”´
    });
  });
});