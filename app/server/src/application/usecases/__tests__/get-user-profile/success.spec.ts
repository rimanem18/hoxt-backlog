/**
 * GetUserProfileUseCase æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ
 *
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—æ©Ÿèƒ½ã®æ­£å¸¸ãªãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼ã€‚
 * æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±å–å¾—æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã¨é–¢é€£ã™ã‚‹ãƒ­ã‚°å‡ºåŠ›ã‚’ç¢ºèªã€‚
 */

import { beforeEach, describe, expect, test } from 'bun:test';
import type { AuthProvider } from '@/domain/user/AuthProvider';
import { makeSUT } from './helpers/makeSUT';
import { GetUserProfileTestMatchers } from './helpers/matchers';
import { UserProfileFactory } from './helpers/userFactory';

describe('GetUserProfileUseCase æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ', () => {
  let sut: ReturnType<typeof makeSUT>;

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«SUTï¼ˆãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã‚’åˆæœŸåŒ–
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã€ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚ã‚’ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    sut = makeSUT();
  });

  describe('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—æˆåŠŸ', () => {
    test('æœ‰åŠ¹ãªuserIdã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®å–å¾—ãŒæˆåŠŸã™ã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æœ‰åŠ¹ãªuserIdã‚’å…¥åŠ›ã¨ã—ã¦ã€æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’æ­£å¸¸ã«å–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: userRepository.findById() ãŒæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿”ã—ã€UseCase ãŒé©åˆ‡ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”å´ã™ã‚‹å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å…¥åŠ›ã•ã‚ŒãŸuserIdã«å¯¾å¿œã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å«ã‚€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã•ã‚Œã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: TASK-106ã®è¦ä»¶å®šç¾©ã«åŸºã¥ãã€æ­£å¸¸ç³»ã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼ã‚’å¿ å®Ÿã«å®Ÿè£…

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰è¿”ã•ã‚Œã‚‹æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ­£å¸¸ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ãŒæˆåŠŸã™ã‚‹å‰æã§ãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒƒã‚¯ã‚’è¨­å®š
      const existingUser = UserProfileFactory.existingUser({
        id: '12345678-1234-4321-abcd-123456789abc',
        externalId: 'google_test_user_123',
        email: 'test.user@example.com',
        name: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
      });

      const input = UserProfileFactory.validInput(
        '12345678-1234-4321-abcd-123456789abc',
      );

      // ãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã‚’è¨­å®š
      const mockFindById = sut.userRepository.findById as unknown as {
        mockResolvedValue: (value: unknown) => void;
      };
      mockFindById.mockResolvedValue(existingUser);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: GetUserProfileUseCaseã®executeãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: ä¾å­˜é–¢ä¿‚ã¨ã—ã¦ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚ŒãŸUserRepositoryã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢å‡¦ç†ã‚’å®Ÿè¡Œ
      const result = await sut.sut.execute(input);

      // ã€çµæœæ¤œè¨¼ã€‘: UseCase ã®å®Ÿè¡ŒçµæœãŒæœŸå¾…é€šã‚Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: è¿”ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å–å¾—ã—ãŸã‚‚ã®ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(result).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: çµæœãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(result.user).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: userãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è©³ç´°æ¤œè¨¼
      GetUserProfileTestMatchers.haveUserProperties(result.user, {
        id: '12345678-1234-4321-abcd-123456789abc',
        externalId: 'google_test_user_123',
        email: 'test.user@example.com',
        name: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
      }); // ã€ç¢ºèªå†…å®¹ã€‘: è¿”ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæœŸå¾…å€¤ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢

      // ä¾å­˜é–¢ä¿‚ã®å‘¼ã³å‡ºã—ç¢ºèª
      GetUserProfileTestMatchers.mock.toHaveBeenCalledWithUserId(
        sut.userRepository.findById,
        '12345678-1234-4321-abcd-123456789abc',
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒªãƒã‚¸ãƒˆãƒªãŒæ­£ã—ã„userIdã§å‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª ğŸŸ¢

      GetUserProfileTestMatchers.mock.toHaveBeenCalledTimes(
        sut.userRepository.findById,
        1,
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒªãƒã‚¸ãƒˆãƒªãŒ1å›ã ã‘å‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('è¤‡æ•°ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œ', () => {
    test.each([
      ['Google', 'google', 'google_user_123', 'google.user@gmail.com'],
      ['GitHub', 'github', 'github_user_456', 'github.user@github.com'],
      [
        'Facebook',
        'facebook',
        'facebook_user_789',
        'facebook.user@facebook.com',
      ],
    ])(
      '%s ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ãŒæˆåŠŸã™ã‚‹',
      async (_provider, providerType, externalId, email) => {
        // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¤‡æ•°ã®èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¯¾å¿œã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆGoogleã€GitHubã€Facebookï¼‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ãŒæˆåŠŸã™ã‚‹
        // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«é–¢ä¿‚ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ­£å¸¸ã«å–å¾—ã•ã‚Œã‚‹
        // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œã¯è¦ä»¶å®šç¾©ã§æ˜ç¢ºã«è¦å®šã•ã‚Œã¦ã„ã‚‹

        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
        // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®æƒ…å ±ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æº–å‚™
        const user = UserProfileFactory.existingUser({
          externalId,
          provider: providerType as AuthProvider, // å‹å®‰å…¨ãªã‚­ãƒ£ã‚¹ãƒˆã«å¤‰æ›´
          email,
          name: `${_provider}ãƒ¦ãƒ¼ã‚¶ãƒ¼`,
        });

        const input = UserProfileFactory.validInput(user.id);

        const mockFindById = sut.userRepository.findById as unknown as {
          mockResolvedValue: (value: unknown) => void;
        };
        mockFindById.mockResolvedValue(user);

        // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†
        // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«é–¢ä¿‚ãªãçµ±ä¸€ã•ã‚ŒãŸUserIdã§ã®æ¤œç´¢å‡¦ç†ã‚’å®Ÿè¡Œ
        const result = await sut.sut.execute(input);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®æƒ…å ±ãŒæ­£ã—ãè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒé©åˆ‡ã«å–å¾—ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
        expect(result).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: çµæœãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
        expect(result.user.provider).toBe(providerType as AuthProvider); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
        expect(result.user.externalId).toBe(externalId); // ã€ç¢ºèªå†…å®¹ã€‘: å¤–éƒ¨IDãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
        expect(result.user.email).toBe(email); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      },
    );
  });

  describe('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ', () => {
    test('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ãŒ500msä»¥å†…ã§å®Œäº†ã™ã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†ãŒæ€§èƒ½è¦ä»¶ï¼ˆ500msä»¥å†…ï¼‰ã‚’æº€ãŸã™ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å‡¦ç†æ™‚é–“ã‚’æ¸¬å®šã—ã€500msä»¥å†…ã§å®Œäº†ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’å«ã‚€å‡¦ç†ãŒåˆ¶é™æ™‚é–“å†…ã§å®Œäº†ã™ã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶500msä»¥å†…ã¯è¦ä»¶å®šç¾©ã§æ˜ç¢ºã«è¦å®šã•ã‚Œã¦ã„ã‚‹

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: é€šå¸¸ã®å‡¦ç†æ™‚é–“ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ãƒ¢ãƒƒã‚¯ã‚’è¨­å®š
      const user = UserProfileFactory.existingUser();
      const input = UserProfileFactory.validInput(user.id);

      const mockFindById = sut.userRepository.findById as unknown as {
        mockResolvedValue: (value: unknown) => void;
      };
      mockFindById.mockResolvedValue(user);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã‚’å«ã‚€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†
      // ã€å‡¦ç†å†…å®¹ã€‘: å‡¦ç†é–‹å§‹ã‹ã‚‰å®Œäº†ã¾ã§ã®æ™‚é–“ã‚’æ¸¬å®šã—ãªãŒã‚‰å®Ÿè¡Œ
      const startTime = performance.now();
      await sut.sut.execute(input);
      const endTime = performance.now();
      const executionTime = endTime - startTime;

      // ã€çµæœæ¤œè¨¼ã€‘: å‡¦ç†æ™‚é–“ãŒæ€§èƒ½è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: å®Ÿéš›ã®å®Ÿè¡Œæ™‚é–“ãŒ500msä»¥å†…ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      GetUserProfileTestMatchers.completeWithinTimeLimit(executionTime); // ã€ç¢ºèªå†…å®¹ã€‘: å‡¦ç†ãŒ500msä»¥å†…ã§å®Œäº†ã—ãŸã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('ãƒ­ã‚°å‡ºåŠ›æ¤œè¨¼', () => {
    test('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—æˆåŠŸæ™‚ã«é©åˆ‡ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ­£å¸¸ç³»å‡¦ç†ã«ãŠã„ã¦é©åˆ‡ãªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å‡¦ç†é–‹å§‹ãƒ»æˆåŠŸæ™‚ã®infoãƒ¬ãƒ™ãƒ«ãƒ­ã‚°ãŒæœŸå¾…ã•ã‚Œã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«å‡ºåŠ›ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ­ã‚°å‡ºåŠ›ã«ã‚ˆã‚Šé‹ç”¨æ™‚ã®ç›£è¦–ãƒ»ãƒ‡ãƒãƒƒã‚°ãŒå¯èƒ½ã«ãªã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ­ã‚°å‡ºåŠ›ã®è©³ç´°ä»•æ§˜ã¯è¦ä»¶å®šç¾©ã§ã¯æ›–æ˜§ã ãŒã€é‹ç”¨ä¸Šå¿…è¦ã¨æ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ­ã‚°æ¤œè¨¼ç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ­ã‚°å‡ºåŠ›ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒ¢ãƒƒã‚¯ãƒ­ã‚¬ãƒ¼ã‚’è¨­å®š
      const user = UserProfileFactory.existingUser({
        id: '12345678-1234-4321-abcd-123456789abc',
      });
      const input = UserProfileFactory.validInput(
        '12345678-1234-4321-abcd-123456789abc',
      );

      const mockFindById = sut.userRepository.findById as unknown as {
        mockResolvedValue: (value: unknown) => void;
      };
      mockFindById.mockResolvedValue(user);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãƒ­ã‚°å‡ºåŠ›ã‚’å«ã‚€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å‡¦ç†
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ­ã‚°å‡ºåŠ›æ©Ÿèƒ½ã‚’æŒã¤UseCaseã®å®Ÿè¡Œ
      await sut.sut.execute(input);

      // ã€çµæœæ¤œè¨¼ã€‘: æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: å‡¦ç†é–‹å§‹ãƒ»æˆåŠŸæ™‚ã®ãƒ­ã‚°ãŒé©åˆ‡ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      GetUserProfileTestMatchers.haveLoggedMessage(
        sut.logger,
        'info',
        'User profile retrieval started',
        { userId: '12345678-1234-4321-abcd-123456789abc' },
      ); // ã€ç¢ºèªå†…å®¹ã€‘: å‡¦ç†é–‹å§‹ãƒ­ã‚°ãŒé©åˆ‡ãªuserIdãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡

      GetUserProfileTestMatchers.haveLoggedMessage(
        sut.logger,
        'info',
        'User profile retrieved successfully',
        { userId: '12345678-1234-4321-abcd-123456789abc' },
      ); // ã€ç¢ºèªå†…å®¹ã€‘: å‡¦ç†æˆåŠŸãƒ­ã‚°ãŒé©åˆ‡ãªuserIdãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡
    });
  });
});
